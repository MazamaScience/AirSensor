<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Outlier Detection with the Hampel Filter • AirSensor</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Outlier Detection with the Hampel Filter">
<meta property="og:description" content="AirSensor">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">AirSensor</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/AirSensor_Function_Overview.html">AirSensor Function Overview</a>
    </li>
    <li>
      <a href="../articles/Developer_Style_Guide.html">Developer Style Guide</a>
    </li>
    <li>
      <a href="../articles/Creating_Data_Archives.html">Creating Data Archives</a>
    </li>
    <li>
      <a href="../articles/Custom_QC_Algorithms.html">Custom QC Algorithms</a>
    </li>
    <li>
      <a href="../articles/Working_with_PurpleAir_API_Keys.html">Working with PurpleAir API Keys</a>
    </li>
    <li>
      <a href="../articles/outlier_detection.html">Outlier Detection with the Hampel Filter</a>
    </li>
    <li>
      <a href="../articles/pas_introduction.html">PurpleAir Synoptic Data</a>
    </li>
    <li>
      <a href="../articles/pat_introduction.html">PurpleAir Time Series Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MazamaScience/AirSensor/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Outlier Detection with the Hampel Filter</h1>
                        <h4 data-toc-skip class="author">Mazama
Science</h4>
            
            <h4 data-toc-skip class="date">2019-04-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MazamaScience/AirSensor/blob/HEAD/vignettes/articles/outlier_detection.Rmd" class="external-link"><code>vignettes/articles/outlier_detection.Rmd</code></a></small>
      <div class="hidden name"><code>outlier_detection.Rmd</code></div>

    </div>

    
    
<p>This vignette explores the use of the <code><a href="../reference/pat_outliers.html">pat_outliers()</a></code>
function to identify and potentially replace timeseries outliers in the
data and the underlying algorithm used that makes this possible.</p>
<div class="section level2">
<h2 id="a-quick-example">A quick example<a class="anchor" aria-label="anchor" href="#a-quick-example"></a>
</h2>
<p>Raw PurpleAir PM 2.5 time series data will occasionally contain
visible outliers – measurements which are not plausibly explained by
atmospheric processes and thus likely due to sensor error. Some monitors
are noisier than others, but a week’s worth of data from any sensor will
likely contain some of these electrical glitches.</p>
<p>Using example data released with the package, let’s have a look at
the raw PM2.5 measurements for a Seattle based sensor during the first
week of August, 2018. We will use the <code>sampleSize = 1e6</code>
argument to prevent sub sampling of the data that might leave out some
outliers. <em>(We’re willing to wait for the plot so we can see
everything!)</em></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pat</span> <span class="op">&lt;-</span> <span class="fu">AirSensor</span><span class="fu">::</span><span class="va"><a href="../reference/example_pat.html">example_pat</a></span></span>
<span></span>
<span><span class="fu"><a href="../reference/pat_multiPlot.html">pat_multiPlot</a></span><span class="op">(</span><span class="va">pat</span>, plottype <span class="op">=</span> <span class="st">"pm25"</span>, sampleSize <span class="op">=</span> <span class="fl">1e6</span><span class="op">)</span></span></code></pre></div>
<p><img src="outlier_detection_files/figure-html/quick_example-1.png" width="672"></p>
<p>We definitely see a few individual data points that look like
outliers while other momentarily elevated levels consist of multiple
measurements and are more likely to represent valid measurements.</p>
<p>Let’s see if our outlier detector can correctly identify outliers
without flagging the more believable measurements:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pat_outliers.html">pat_outliers</a></span><span class="op">(</span><span class="va">pat</span>, showPlot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="outlier_detection_files/figure-html/pat_outliers-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="the-hampel-filter">The Hampel Filter<a class="anchor" aria-label="anchor" href="#the-hampel-filter"></a>
</h2>
<p>The <a href="https://cran.r-project.org/web/packages/seismicRoll/index.html" class="external-link">seismicRoll</a>
R package was developed for use with high resolution seismology
waveforms. It provides high performance functions for a variety of
signal processing algorithms including the Hampel Filter.</p>
<p>The <code>pat_outlier()</code> function uses the Hampel filter to
identify outliers. The Hampel filter is a robust outlier detector that
uses <a href="https://en.wikipedia.org/wiki/Median_absolute_deviation" class="external-link">Median
Absolute Deviation</a>. For each point, a median and standard deviation
are calculated using all neighboring values within a window of size
<code>windowSize</code>. If the point of interest lies multiple standard
deviations from the median it is flagged as an outlier. As the Hampel
value increases, the more likely it is that the value is an outlier.
However, there is no universally appropriate window size or threshold to
use. It’s up to us to come up with our own window size and threshold
based on the characteristics of our time series.</p>
<p>Detailed discussion of the algorithm is available at:</p>
<ul>
<li>
<a href="https://www.mathworks.com/help/dsp/ref/hampelfilter.html" class="external-link">Hampel
Filter</a> – Matlab function documentation</li>
<li>
<a href="https://link.springer.com/article/10.1186/s13634-016-0383-6" class="external-link">Generalized
Hampel Filter</a> – Journal on Advances in Signal Processing</li>
</ul>
<div class="section level3">
<h3 id="window-width-and-detection-threshold">Window width and detection threshold<a class="anchor" aria-label="anchor" href="#window-width-and-detection-threshold"></a>
</h3>
<p>The <code><a href="../reference/pat_outliers.html">pat_outliers()</a></code> function provides two parameters to
control outlier detection:</p>
<ul>
<li>
<code>windowSize</code> – number of measurements to include in a
window</li>
<li>
<code>thresholdMin</code> – number of std. dev. units above which a
measurement is considered an outlier</li>
</ul>
<p>The default setting of <code>windowSize = 23</code> means that 23
samples from a single channel become the population from which the
median and standard deviation are calculated. Each Purple Air channel
makes a measurement approximately every 80 seconds so the temporal
window is 23 * 80 sec or approximately 30 minutes. This seems like a
reasonable period of time over which to evaluate PM2.5 measurements. It
is long enough to capture significant change making it more likely we
will only identify true outliers.</p>
<p>The default setting for the detection threshold
<code>thresholdMin = 8</code> means that the sample at the center of the
rolling window must have a value at least 8 standard deviation units
away from the window median to be flagged as an outlier.</p>
<p>To explain how this works, we will focus on a single day’s worth of
data and use base R functionality to zoom in and visually explore the
algorithm. We start with a visual inspection of the data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oneDayData</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">pat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/pat_filterDate.html">pat_filterDate</a></span><span class="op">(</span><span class="st">"2022-07-02"</span>, days <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pat_extractDataFrame.html">pat_extractData</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visually inspect for outliers</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">oneDayData</span><span class="op">$</span><span class="va">datetime</span>, <span class="va">oneDayData</span><span class="op">$</span><span class="va">pm25_A</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"Jul 02, 2022"</span>, ylab <span class="op">=</span> <span class="st">"ug/m3"</span>, las <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"A channel PM2.5"</span><span class="op">)</span></span></code></pre></div>
<p><img src="outlier_detection_files/figure-html/visual_inspection-1.png" width="672"></p>
<p>We definitely have what looks to the eye like outliers so let’s use
the <code><a href="https://rdrr.io/pkg/seismicRoll/man/findOutliers.html" class="external-link">seismicRoll::findOutliers()</a></code> function to figure out
exactly where they are:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find the outliers</span></span>
<span><span class="fu">seismicRoll</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/seismicRoll/man/findOutliers.html" class="external-link">findOutliers</a></span><span class="op">(</span><span class="va">oneDayData</span><span class="op">$</span><span class="va">pm25_A</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## integer(0)</span></span></code></pre>
<p>The following example explains the outlier detection process with a
single window centered on the outlier at index <code>872</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set example point, neighbors, median, and window</span></span>
<span><span class="va">windowWidth</span> <span class="op">&lt;-</span> <span class="fl">23</span></span>
<span><span class="va">halfWidth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">23</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">exampleIndex</span> <span class="op">&lt;-</span> <span class="fl">240</span></span>
<span><span class="va">windowStart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">exampleIndex</span> <span class="op">-</span> <span class="va">halfWidth</span><span class="op">)</span></span>
<span><span class="va">windowEnd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">exampleIndex</span> <span class="op">+</span> <span class="va">halfWidth</span><span class="op">)</span></span>
<span><span class="va">exampleNeighbors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">windowStart</span><span class="op">:</span><span class="op">(</span><span class="va">exampleIndex</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>, <span class="op">(</span><span class="va">exampleIndex</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">windowEnd</span><span class="op">)</span></span>
<span><span class="va">windowMedian</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">oneDayData</span><span class="op">$</span><span class="va">pm25_A</span><span class="op">[</span><span class="va">exampleNeighbors</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">windowSd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">oneDayData</span><span class="op">$</span><span class="va">pm25_A</span><span class="op">[</span><span class="va">exampleNeighbors</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the window around the example point along with the window median</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">oneDayData</span><span class="op">$</span><span class="va">datetime_A</span><span class="op">[</span><span class="va">windowStart</span><span class="op">:</span><span class="va">windowEnd</span><span class="op">]</span>, </span>
<span>     <span class="va">oneDayData</span><span class="op">$</span><span class="va">pm25_A</span><span class="op">[</span><span class="va">windowStart</span><span class="op">:</span><span class="va">windowEnd</span><span class="op">]</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"black"</span>, pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">1</span>,</span>
<span>     main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Window Around Measurement #"</span>, <span class="va">exampleIndex</span><span class="op">)</span>,</span>
<span>     las <span class="op">=</span> <span class="fl">1</span>, xlab <span class="op">=</span> <span class="st">"Time (UTC)"</span>, ylab <span class="op">=</span> <span class="st">"PM 2.5 (ug/m3)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">oneDayData</span><span class="op">$</span><span class="va">datetime_A</span><span class="op">[</span><span class="va">exampleIndex</span><span class="op">]</span>, </span>
<span>       <span class="va">oneDayData</span><span class="op">$</span><span class="va">pm25_A</span><span class="op">[</span><span class="va">exampleIndex</span><span class="op">]</span>,</span>
<span>       col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># Add lines for the median and several standard deviations beyond</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">windowMedian</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">windowMedian</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span> <span class="op">*</span> <span class="va">windowSd</span>, </span>
<span>       lty <span class="op">=</span> <span class="st">"dashed"</span>, col <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span></span>
<span><span class="co"># Add a legend</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"topright"</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Point of Interest"</span>, </span>
<span>                  <span class="st">"Neighbors"</span>, </span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Median = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">windowMedian</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Stddev = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">windowSd</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"orange"</span><span class="op">)</span>,</span>
<span>       lwd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, </span>
<span>       lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">"solid"</span>, <span class="st">"dashed"</span><span class="op">)</span>, </span>
<span>       pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">16</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="outlier_detection_files/figure-html/hampel_window-1.png" width="672"></p>
<p>The example code above can be applied to any outliers identified with
<code><a href="https://rdrr.io/pkg/seismicRoll/man/findOutliers.html" class="external-link">seismicRoll::findOutliers()</a></code> to gain a better understanding
of why each point is flagged as an outlier. Remember that this is a
“rolling” algorithm and that the <code>windowMedian</code> and
<code>windowSd</code> are recalculated for every single point in the
timeseries.</p>
<p>If an outlier is detected even when it visually appears to lie on top
of other data points it just means that the window-local median and
standard deviation are very small, thus requiring much smaller
deviations from the median to be flagged as an outlier.</p>
</div>
</div>
<div class="section level2">
<h2 id="replacing-values">Replacing values<a class="anchor" aria-label="anchor" href="#replacing-values"></a>
</h2>
<p>The <code>pat_outlier()</code> function allows you to replace
detected outliers with the <code>windowMedian</code>, resulting in a
cleaner timeseries with likely electrical glitches removed. The
following plots demonstrate replacement of outliers.</p>
<div class="section level3">
<h3 id="no-outlier-replacement">No outlier replacement<a class="anchor" aria-label="anchor" href="#no-outlier-replacement"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pat2Day</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/pat_filterDate.html">pat_filterDate</a></span><span class="op">(</span><span class="va">pat</span>, <span class="st">"2022-07-02"</span>, days <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># No outlier replacement</span></span>
<span><span class="va">pat2Day</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/pat_multiPlot.html">pat_multiPlot</a></span><span class="op">(</span><span class="st">"pm25"</span>, sampleSize <span class="op">=</span> <span class="fl">1e6</span><span class="op">)</span></span></code></pre></div>
<p><img src="outlier_detection_files/figure-html/hampel_smoothing_0-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="default-outlier-replacement">Default outlier replacement<a class="anchor" aria-label="anchor" href="#default-outlier-replacement"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Default outlier replacement</span></span>
<span><span class="va">pat2Day</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pat_outliers.html">pat_outliers</a></span><span class="op">(</span>windowSize <span class="op">=</span> <span class="fl">23</span>, thresholdMin <span class="op">=</span> <span class="fl">8</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pat_multiPlot.html">pat_multiPlot</a></span><span class="op">(</span><span class="st">"pm25"</span>, sampleSize <span class="op">=</span> <span class="fl">1e6</span><span class="op">)</span></span></code></pre></div>
<p><img src="outlier_detection_files/figure-html/hampel_smoothing_1-1.png" width="672"><img src="outlier_detection_files/figure-html/hampel_smoothing_1-2.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="aggressive-outlier-replacement">Aggressive outlier replacement<a class="anchor" aria-label="anchor" href="#aggressive-outlier-replacement"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Aggressive outlier replacement </span></span>
<span><span class="va">pat2Day</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pat_outliers.html">pat_outliers</a></span><span class="op">(</span>windowSize <span class="op">=</span> <span class="fl">23</span>, thresholdMin <span class="op">=</span> <span class="fl">4</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pat_multiPlot.html">pat_multiPlot</a></span><span class="op">(</span><span class="st">"pm25"</span>, sampleSize <span class="op">=</span> <span class="fl">1e6</span><span class="op">)</span></span></code></pre></div>
<p><img src="outlier_detection_files/figure-html/hampel_smoothing_2-1.png" width="672"><img src="outlier_detection_files/figure-html/hampel_smoothing_2-2.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jonathan Callahan, Hans Martin, Kayleigh Wilson, Tate Brasel, Helen Miller.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
