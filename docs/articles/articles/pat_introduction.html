<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PurpleAir TimeSeries Data • AirSensor</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="PurpleAir TimeSeries Data">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">AirSensor</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/AirSensor_Function_Overview.html">AirSensor Function Overview</a>
    </li>
    <li>
      <a href="../../articles/Developer_Style_Guide.html">Developer Style Guide</a>
    </li>
    <li>
      <a href="../../articles/articles/Australia_on_fire.html">Australia on Fire</a>
    </li>
    <li>
      <a href="../../articles/articles/DataFlowChart.html">Processing PurpleAir Data</a>
    </li>
    <li>
      <a href="../../articles/articles/SoH_functions.html">SoH Functions</a>
    </li>
    <li>
      <a href="../../articles/articles/outlier_detection.html">Outlier Detection with the Hampel Filter</a>
    </li>
    <li>
      <a href="../../articles/articles/pas_introduction.html">PurpleAir Synoptic Data</a>
    </li>
    <li>
      <a href="../../articles/articles/pat_introduction.html">PurpleAir TimeSeries Data</a>
    </li>
    <li>
      <a href="../../articles/articles/purpleair_failure_modes.html">PurpleAir Failure Modes</a>
    </li>
    <li>
      <a href="../../articles/articles/purpleair_qc.html">Purple Air Quality Control</a>
    </li>
    <li>
      <a href="../../articles/articles/purpleair_sensors.html">Purple Air Sensors</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MazamaScience/AirSensor">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>PurpleAir TimeSeries Data</h1>
                        <h4 class="author">Mazama Science</h4>
            
            <h4 class="date">2019-04-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MazamaScience/AirSensor/blob/master/vignettes/articles/pat_introduction.Rmd"><code>vignettes/articles/pat_introduction.Rmd</code></a></small>
      <div class="hidden name"><code>pat_introduction.Rmd</code></div>

    </div>

    
    
<p><em>Time series</em> data provides a minute-by-minute database structure for transforming and analyzing <a href="https://www.purpleair.com/">PurpleAir</a> sensor data. This vignette demonstrates an example analysis of an individual monitor located in Seattle, Washington over a two-month duration in which the Pacific Northwest experienced <a href="https://www.usnews.com/news/healthiest-communities/articles/2018-08-19/air-quality-to-worsen-in-northwest-as-smoke-returns">hazardous air-quality conditions</a> caused by wildfires in British Columbia, Canada.</p>
<p><strong>Disclaimer:</strong> It is highly recommended that you read <code>vignettes/pas_introduction.Rmd</code> before beginning this tutorial.</p>
<div id="loading-purpleair-timeseries-data" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-purpleair-timeseries-data" class="anchor"></a>Loading PurpleAir Timeseries data</h2>
<p>PurpleAir sensor readings are uploaded to the cloud every 120 seconds where they are stored for download and display on the PurpleAir website. After every interval, the synoptic data is refreshed and the outdated synoptic data is then stored in a <a href="https://thingspeak.com">ThingSpeak</a> database. In order to access the ThingSpeak channel API we must first load the synoptic database, but for the purposes of this example, we are going to use the <code>example_pas</code> associated with the <em>AirSensor</em> package.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(MazamaCoreUtils)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(AirSensor)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">pas &lt;-<span class="st"> </span>AirSensor<span class="op">::</span>example_pas</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">id &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/pas_getDeviceDeploymentIDs.html">pas_getDeviceDeploymentIDs</a></span>(pas, <span class="st">"^Seattle$"</span>)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1-8" data-line-number="8">pat &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/pat_createNew.html">pat_createNew</a></span>(<span class="dt">id =</span> id, </a>
<a class="sourceLine" id="cb1-9" data-line-number="9">                     <span class="dt">pas =</span> pas, </a>
<a class="sourceLine" id="cb1-10" data-line-number="10">                     <span class="dt">startdate =</span> <span class="dv">20180701</span>, </a>
<a class="sourceLine" id="cb1-11" data-line-number="11">                     <span class="dt">enddate =</span> <span class="dv">20180901</span>)</a></code></pre></div>
<p>Notice that when passing our synoptic dataframe “<code>pas</code>” to <code><a href="../../reference/pat_createNew.html">pat_createNew()</a></code>, we also supply unique identification and a date-interval. In this case, our monitor-of-interest (MOI) is a sensor named “Seattle” and our dates-of-interest are 2018-07-01 to 2018-09-01. In order to uniquely identify each sensor we have created the <code>deviceDeploymentID</code> (called <code>id</code> in the <code><a href="../../reference/pat_createNew.html">pat_createNew()</a></code> function), which is used to associate each sensor with it’s location. This identifier is a better way to access individual “pat” objects than the <code>label</code> which is not guaranteed to be unique. For example, if we were looking for a sensor called “home” in the <code>pas</code> we would find more than one “pat” object.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">id_home &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/pas_getDeviceDeploymentIDs.html">pas_getDeviceDeploymentIDs</a></span>(pas, <span class="st">"^Home$"</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(id_home)</a></code></pre></div>
<pre><code>## [1] 5</code></pre>
<p><strong>Note:</strong> You must provide either a “label” or “id” to <code><a href="../../reference/pat_createNew.html">pat_createNew()</a></code> in addition to the <code>pas</code> object in order to supply ThingSpeak with the necessary metadata to access the sensors database. A time range on the other hand is optional; by default not providing <code><a href="../../reference/pat_createNew.html">pat_createNew()</a></code> with a start and end date will return the most recent week of time series data.</p>
</div>
<div id="the-purpleairtimeseries-pat-data-model" class="section level2">
<h2 class="hasAnchor">
<a href="#the-purpleairtimeseries-pat-data-model" class="anchor"></a>The PurpleAirTimeseries (“pat”) Data Model</h2>
<p>Let’s begin by exploring the attributes of the dataframe returned by the <code><a href="../../reference/pat_createNew.html">pat_createNew()</a></code> function.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">pat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>()</a></code></pre></div>
<pre><code>## [1] "meta" "data"</code></pre>
<p><code>pat</code> contains <em>two</em> dataframes, <code>meta</code> and <code>data</code>.</p>
<p>The <code>meta</code> dataframe contains metadata of the selected PurpleAir sensor – this includes non-time series data such as location information, labels, etc. The <code>data</code> dataframe contains datestamped sensor readings of PM2.5, temperature, humidity, and other pertinent sensor data.</p>
<p>We’ll start by plotting PurpleAir’s raw sensor data. We can quickly display the time series data by using <code><a href="../../reference/pat_multiplot.html">pat_multiplot()</a></code> and passing in our raw <code>pat</code> and desired plot type (“<code>all</code>” sensor data).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">pat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../../reference/pat_multiplot.html">pat_multiplot</a></span>(<span class="dt">plottype =</span> <span class="st">"all"</span>)</a></code></pre></div>
<p><img src="pat_introduction_files/figure-html/allPlot-1.png" width="672"></p>
</div>
<div id="exploring-time-series-data" class="section level2">
<h2 class="hasAnchor">
<a href="#exploring-time-series-data" class="anchor"></a>Exploring Time Series Data</h2>
<p>Our <code>pat</code> dataframe spans two months. While this provides a great overview of PM2.5, it is unwieldy to analyze if we are only interested in anomalous air quality. We can use <code><a href="../../reference/pat_filterDate.html">pat_filterDate()</a></code> to subset our <code>pat</code> dates. In this case, we’ll reduce our time range to 2018-08-01 - 2018-09-01.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">pat_august &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="st">  </span>pat <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../../reference/pat_filterDate.html">pat_filterDate</a></span>(<span class="dt">startdate =</span> <span class="dv">20180801</span>, <span class="dt">enddate =</span> <span class="dv">20180901</span>)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">pat_august <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../../reference/pat_multiplot.html">pat_multiplot</a></span>(<span class="dt">plottype =</span> <span class="st">"pm25_over"</span>)</a></code></pre></div>
<p><img src="pat_introduction_files/figure-html/augustPlot-1.png" width="672"></p>
<p>We can look for correlations in the raw data with <code><a href="../../reference/pat_scatterMatrixPlot.html">pat_scatterMatrixPlot()</a></code>. When a sensor is properly functioning, the only correlations will be a strong positive one between between the A and B channels (<code>pm25_A:pm25_B</code>) and a strong negative one between temperature and humidity.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">  pat_august <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="../../reference/pat_scatterMatrixPlot.html">pat_scatterMatrixPlot</a></span>()</a></code></pre></div>
<p><img src="pat_introduction_files/figure-html/scatterplot-1.png" width="672"></p>
</div>
<div id="outlier-detection" class="section level2">
<h2 class="hasAnchor">
<a href="#outlier-detection" class="anchor"></a>Outlier Detection</h2>
<p>Our <code>pat_august</code> “pat” object displays some intermittent sensor errors that appear as spikes in the data. In order to identify and remove PM2.5 outliers like these we can use <code><a href="../../reference/pat_outliers.html">pat_outliers()</a></code>. By default, this function will create a plot of the raw data with outliers marked with a red asterisk. It can also be used to replace outliers with window median values.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">pat_august_filtered &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">  </span>pat_august <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../../reference/pat_outliers.html">pat_outliers</a></span>(<span class="dt">replace =</span> <span class="ot">TRUE</span>, <span class="dt">showPlot =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="pat_introduction_files/figure-html/outlierPlot-1.png" width="672"></p>
</div>
<div id="ab-channel-comparison" class="section level2">
<h2 class="hasAnchor">
<a href="#ab-channel-comparison" class="anchor"></a>A/B Channel Comparison</h2>
<p>Now that we have a filtered dataset we can subset the data further and examine it in more detail. The <code><a href="../../reference/pat_internalFit.html">pat_internalFit()</a></code> function will compare PM2.5 data from the A and B channels to verify that the sensor is functioning properly.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">one_week &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">  </span>pat_august <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../../reference/pat_filterDate.html">pat_filterDate</a></span>(<span class="dt">startdate =</span> <span class="dv">20180813</span>, <span class="dt">days =</span> <span class="dv">7</span>)</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co"># Channel A/B comparison</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6">one_week <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="../../reference/pat_internalFit.html">pat_internalFit</a></span>()</a></code></pre></div>
<p><img src="pat_introduction_files/figure-html/internalFit-1.png" width="672"></p>
<p>The high R<sup>2</sup> value indicates that the two channels are highly correlated while a slope of ~0.9 suggests a slight relative bias in the measurements. (Perfect alignment would have a slope of 1.0.)</p>
</div>
<div id="comparison-with-federal-monitors" class="section level2">
<h2 class="hasAnchor">
<a href="#comparison-with-federal-monitors" class="anchor"></a>Comparison with Federal Monitors</h2>
<p>For locations near federal monitors that are part of the <a href="https://tools.airfire.org/monitoring/v4">USFS Monitoring site</a>, we can also compare the sensor data with hourly data from a federal monitor</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># Sensor/Monitor comparison</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">one_week <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../../reference/pat_externalFit.html">pat_externalFit</a></span>()</a></code></pre></div>
<p><img src="pat_introduction_files/figure-html/externalFit-1.png" width="672"></p>
<p>Overall, this is an excellent fit with the PurpleAir sensor capturing the temporal evolution of the wildfire smoke event impacting Seattle. The sensor data is biased a little high relative to the monitoring data but the much higher temporal resolution of the sensor provides a rich dataset to work with.</p>
<p>This package contains many additional functions for working with PurpleAir data and users are encouraged to review the reference documentation.</p>
<p><em>Happy Exploring!</em></p>
<p><em>Mazama Science</em></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#loading-purpleair-timeseries-data">Loading PurpleAir Timeseries data</a></li>
      <li><a href="#the-purpleairtimeseries-pat-data-model">The PurpleAirTimeseries (“pat”) Data Model</a></li>
      <li><a href="#exploring-time-series-data">Exploring Time Series Data</a></li>
      <li><a href="#outlier-detection">Outlier Detection</a></li>
      <li><a href="#ab-channel-comparison">A/B Channel Comparison</a></li>
      <li><a href="#comparison-with-federal-monitors">Comparison with Federal Monitors</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jonathan Callahan, Hans Martin, Kayleigh Wilson, Tate Brasel, Helen Miller.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
