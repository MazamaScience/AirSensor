<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MVCAA Tutorial 6: Methow Vallely Smoke • AirSensor</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="MVCAA Tutorial 6: Methow Vallely Smoke">
<meta property="og:description" content="AirSensor">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">AirSensor</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/AirSensor_Function_Overview.html">AirSensor Function Overview</a>
    </li>
    <li>
      <a href="../../articles/Developer_Style_Guide.html">Developer Style Guide</a>
    </li>
    <li>
      <a href="../../articles/articles/Australia_on_fire.html">Australia on Fire</a>
    </li>
    <li>
      <a href="../../articles/articles/Custom_QC_Algorithms.html">Custom QC Algorithms</a>
    </li>
    <li>
      <a href="../../articles/articles/DataFlowChart.html">Processing PurpleAir Data</a>
    </li>
    <li>
      <a href="../../articles/articles/MVCAA_Tutorial_1.html">MVCAA Tutorial 1: Creating PAT Data</a>
    </li>
    <li>
      <a href="../../articles/articles/MVCAA_Tutorial_2.html">MVCAA Tutorial 2: Exploring PAT Data</a>
    </li>
    <li>
      <a href="../../articles/articles/MVCAA_Tutorial_3.html">MVCAA Tutorial 3: Creating Airsensor Data</a>
    </li>
    <li>
      <a href="../../articles/articles/MVCAA_Tutorial_4.html">MVCAA Tutorial 4: Exploring Airsensor Data</a>
    </li>
    <li>
      <a href="../../articles/articles/MVCAA_Tutorial_5.html">MVCAA Tutorial 5: Building a Local Archive</a>
    </li>
    <li>
      <a href="../../articles/articles/MVCAA_Tutorial_6.html">MVCAA Tutorial 6: Methow Vallely Smoke</a>
    </li>
    <li>
      <a href="../../articles/articles/SoH_functions.html">SoH Functions</a>
    </li>
    <li>
      <a href="../../articles/articles/Temporal_Aggregation.html">Temporally Aggregated Time Series</a>
    </li>
    <li>
      <a href="../../articles/articles/outlier_detection.html">Outlier Detection with the Hampel Filter</a>
    </li>
    <li>
      <a href="../../articles/articles/pas_introduction.html">PurpleAir Synoptic Data</a>
    </li>
    <li>
      <a href="../../articles/articles/pat_introduction.html">PurpleAir Time Series Data</a>
    </li>
    <li>
      <a href="../../articles/articles/purpleair_failure_modes.html">PurpleAir Failure Modes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MazamaScience/AirSensor/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="MVCAA_Tutorial_6_files/header-attrs-2.5/header-attrs.js"></script><link href="MVCAA_Tutorial_6_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="MVCAA_Tutorial_6_files/anchor-sections-1.0/anchor-sections.js"></script><script src="MVCAA_Tutorial_6_files/htmlwidgets-1.5.3/htmlwidgets.js"></script><script src="MVCAA_Tutorial_6_files/jquery-1.12.4/jquery.min.js"></script><link href="MVCAA_Tutorial_6_files/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="MVCAA_Tutorial_6_files/leaflet-1.3.1/leaflet.js"></script><link href="MVCAA_Tutorial_6_files/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="MVCAA_Tutorial_6_files/proj4-2.6.2/proj4.min.js"></script><script src="MVCAA_Tutorial_6_files/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="MVCAA_Tutorial_6_files/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="MVCAA_Tutorial_6_files/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="MVCAA_Tutorial_6_files/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="MVCAA_Tutorial_6_files/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>MVCAA Tutorial 6: Methow Vallely Smoke</h1>
                        <h4 class="author">Mazama Science</h4>
            
            <h4 class="date">2021-03-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MazamaScience/AirSensor/blob/master/vignettes/articles/MVCAA_Tutorial_6.Rmd"><code>vignettes/articles/MVCAA_Tutorial_6.Rmd</code></a></small>
      <div class="hidden name"><code>MVCAA_Tutorial_6.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This tutorial demonstrates how to evaluate the performance of PA sensors by applying functions from the <strong>AirSensor</strong> package explored in previous tutorials. In order to run the code in this tutorial you must have followed the instructions in Tutorial 5 and created a local, multi-month archive of PurpleAir timeseries data. Target audiences include grad students, researchers and any member of the public concerned about air quality and comfortable working with R and RStudio.</p>
<p>Tutorials in this series include:</p>
<ul>
<li><a href="https://mazamascience.github.io/AirSensor/articles/articles/MVCAA_Tutorial_1.html">MVCAA Tutorial 1: Creating PAT Data</a></li>
<li><a href="https://mazamascience.github.io/AirSensor/articles/articles/MVCAA_Tutorial_2.html">MVCAA Tutorial 2: Exploring PAT Data</a></li>
<li><a href="https://mazamascience.github.io/AirSensor/articles/articles/MVCAA_Tutorial_3.html">MVCAA Tutorial 3: Creating Airsensor Data</a></li>
<li><a href="https://mazamascience.github.io/AirSensor/articles/articles/MVCAA_Tutorial_4.html">MVCAA Tutorial 4: Exploring Airsensor Data</a></li>
<li><a href="https://mazamascience.github.io/AirSensor/articles/articles/MVCAA_Tutorial_5.html">MVCAA Tutorial 5: Building a Local Archive</a></li>
<li><a href="https://mazamascience.github.io/AirSensor/articles/articles/MVCAA_Tutorial_6.html">MVCAA Tutorial 6: Methow Vallely Smoke</a></li>
</ul>
</div>
<div id="goal" class="section level2">
<h2 class="hasAnchor">
<a href="#goal" class="anchor"></a>Goal</h2>
<p>The goal in this tutorial is to demonstrate how to evaluate the performance of PA sensors under very high PM25 concentrations due to wildfire smoke. We will do some basic data exploration and evaluate several PA sensors, comparing their data with data from a nearby regulatory monitor.</p>
</div>
<div id="intro" class="section level2">
<h2 class="hasAnchor">
<a href="#intro" class="anchor"></a>Intro</h2>
<p>On September 6 and 7, two wildfires were ignited not far from the Methow Valley –- <a href="https://inciweb.nwcg.gov/incident/7161/">Cold Springs</a> and <a href="https://inciweb.nwcg.gov/incident/7169/">Pearl Hill</a>, together burning over 410,000 acres of grass and shrub throughout the month. Additionally, at the beginning of September, multiple wildfires exploded across the Oregon Cascades, and a “super massive” plume of smoke was carried to Washington State by southerly winds. Eventually the smoke settled in the valleys and basins of Washington and air pollution reached unhealthy levels across the state (See: <a href="https://wasmoke.blogspot.com/2020/09/" class="uri">https://wasmoke.blogspot.com/2020/09/</a>). The timeseries plots below show that September was the smokiest month during the Fall of 2020.</p>
</div>
<div id="data-and-graphics" class="section level2">
<h2 class="hasAnchor">
<a href="#data-and-graphics" class="anchor"></a>Data and Graphics</h2>
<p>Let’s begin our journey by plotting hourly values and daily averages for our MVCAA sensors during September, 2020.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># libraries</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MazamaScience/AirSensor">AirSensor</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MazamaScience/PWFSLSmoke">PWFSLSmoke</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MazamaScience/AirMonitorPlots">AirMonitorPlots</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="co"># Use the default archiveDir unless it is already defined</span>
<span class="kw">if</span> <span class="op">(</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"archiveDir"</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span>
  <span class="va">archiveDir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"~/Data/MVCAA"</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Set the package archiveBaseDir so we can load sensor objects with `sensor_load()`</span>
<span class="fu"><a href="../../reference/setArchiveBaseDir.html">setArchiveBaseDir</a></span><span class="op">(</span><span class="va">archiveDir</span><span class="op">)</span>

<span class="co"># Load sensor data from our archive </span>
<span class="va">mvcaa_sensors_fall</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../../reference/sensor_load.html">sensor_load</a></span><span class="op">(</span>
    collection <span class="op">=</span> <span class="st">"mvcaa"</span>,
    startdate <span class="op">=</span> <span class="fl">20200901</span>,
    enddate <span class="op">=</span> <span class="fl">20201201</span>,
    timezone <span class="op">=</span> <span class="st">"America/Los_Angeles"</span>
  <span class="op">)</span>

<span class="co"># Plot all hourly values with daily averages</span>
<span class="va">mvcaa_sensors_fall</span> <span class="op">%&gt;%</span>
  <span class="fu">AirMonitorPlots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AirMonitorPlots/man/ggplot_pm25Timeseries.html">ggplot_pm25Timeseries</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"MVCAA Sensors -- Fall, 2020"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">AirMonitorPlots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AirMonitorPlots/man/geom_pm25Points.html">geom_pm25Points</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="st">"square"</span>, alpha <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">AirMonitorPlots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AirMonitorPlots/man/stat_dailyAQCategory.html">stat_dailyAQCategory</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">300</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">AirMonitorPlots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AirMonitorPlots/man/custom_aqiStackedBar.html">custom_aqiStackedBar</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> </code></pre></div>
<p><img src="MVCAA_Tutorial_6_files/figure-html/directory-setup-1.png" width="672"></p>
<p>Lets now find some official monitors in the Methow Valley for comparison. Data for FRM/FEM monitors is available using the <strong>PWFSLSmoke</strong> package.</p>
<p><em>NOTE:</em> We refer to hourly aggregated PA data from the <strong>AirSensor</strong> as ‘sensors’ and hourly FRM data from the <strong>PWFSLSmoke</strong> package as ‘monitors’ but the data structures are nearly identical and both can be used with <code>monitor_~()</code> functions from the <strong>PWFSLSmoke</strong> package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Methow Valley region </span>
<span class="va">xlim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">mvcaa_sensors_fall</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">longitude</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">mvcaa_sensors_fall</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">longitude</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">ylim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">mvcaa_sensors_fall</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">latitude</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">mvcaa_sensors_fall</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">latitude</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># load September monitor data </span>
<span class="va">mv_monitors_fall</span> <span class="op">&lt;-</span> 
  <span class="fu">PWFSLSmoke</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PWFSLSmoke/man/monitor_load.html">monitor_load</a></span><span class="op">(</span>startdate <span class="op">=</span> <span class="fl">20200901</span>, enddate <span class="op">=</span> <span class="fl">20201201</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/PWFSLSmoke/man/monitor_subset.html">monitor_subset</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="va">xlim</span>, ylim <span class="op">=</span> <span class="va">ylim</span><span class="op">)</span>

<span class="co"># Plot all monitor data with daily averages</span>
<span class="va">mv_monitors_fall</span> <span class="op">%&gt;%</span>
  <span class="fu">AirMonitorPlots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AirMonitorPlots/man/ggplot_pm25Timeseries.html">ggplot_pm25Timeseries</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Methow Valley FRM monitors -- Fall, 2020"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">AirMonitorPlots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AirMonitorPlots/man/geom_pm25Points.html">geom_pm25Points</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="st">"square"</span>, alpha <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">AirMonitorPlots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AirMonitorPlots/man/stat_dailyAQCategory.html">stat_dailyAQCategory</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">300</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">AirMonitorPlots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AirMonitorPlots/man/custom_aqiStackedBar.html">custom_aqiStackedBar</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></code></pre></div>
<p><img src="MVCAA_Tutorial_6_files/figure-html/r%20fall-overview-monitors-1.png" width="672"></p>
<p>Data from the PurpleAir sensors and the regulatory monitors tell a very similar story. Let’s look more closely at how PA sensors performed compared to one of the FRM monitors in September, 2020. We use an interactive map to identify the monitorID associated with Twisp, Washington.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Click on Twisp in the interactive map</span>
<span class="fu">PWFSLSmoke</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PWFSLSmoke/man/monitor_leaflet.html">monitor_leaflet</a></span><span class="op">(</span><span class="va">mv_monitors_fall</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-47a0d83fd0ef7cfa9514" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-47a0d83fd0ef7cfa9514">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"setView":[[48.42085,-120.15585],11,[]],"calls":[{"method":"addProviderTiles","args":["Esri.WorldTopoMap",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addCircleMarkers","args":[[48.4772,48.3645],[-120.1906,-120.1211],10,null,null,{"interactive":true,"className":"","stroke":false,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":["#8F3F97","#8F3F97"],"fillOpacity":0.7},null,null,["siteName: Winthrop-Chewuch Rd<br>monitorID: 530470010_01<br>elevation: 536<br>pm25: 239.3<br>","siteName: Twisp-Glover St<br>monitorID: 530470009_01<br>elevation: 492<br>pm25: 215.7<br>"],null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLegend","args":[{"colors":["#7E0023","#8F3F97","#FF0000","#FF7E00","#FFFF00","#00E400"],"labels":["Hazardous","Very Unhealthy","Unhealthy","USG","Moderate","Good"],"na_color":null,"na_label":"NA","opacity":1,"position":"bottomright","type":"unknown","title":"AQI Level","extra":null,"layerId":null,"className":"info legend","group":null}]}],"limits":{"lat":[48.3645,48.4772],"lng":[-120.1906,-120.1211]}},"evals":[],"jsHooks":[]}</script><p>With the <code>monitorID</code> for Twisp, we can isolate that monitor and review the <code>meta</code> dataframe which contains the associated spatial metadata.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a single-monitor object for Twisp</span>
<span class="co"># NOTE:  The older PWFSLSmoke package monitor_~() functions use a "subset" </span>
<span class="co"># NOTE:  style syntax rather than the more modern "filter" style syntax.</span>
<span class="va">Twisp_monitor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PWFSLSmoke/man/monitor_subset.html">monitor_subset</a></span><span class="op">(</span>
  <span class="va">mv_monitors_fall</span>, 
  monitorIDs <span class="op">=</span> <span class="st">"530470009_01"</span>,
  tlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20200901</span>, <span class="fl">20201001</span><span class="op">)</span>,
  timezone <span class="op">=</span> <span class="st">"America/Los_Angeles"</span>
<span class="op">)</span>

<span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">Twisp_monitor</span><span class="op">$</span><span class="va">meta</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 1
## Columns: 19
## $ monitorID             &lt;chr&gt; "530470009_01"
## $ longitude             &lt;dbl&gt; -120.1211
## $ latitude              &lt;dbl&gt; 48.3645
## $ elevation             &lt;dbl&gt; 492
## $ timezone              &lt;chr&gt; "America/Los_Angeles"
## $ countryCode           &lt;chr&gt; "US"
## $ stateCode             &lt;chr&gt; "WA"
## $ siteName              &lt;chr&gt; "Twisp-Glover St"
## $ agencyName            &lt;chr&gt; "Washington Department of Ecology"
## $ countyName            &lt;chr&gt; "Chelan"
## $ msaName               &lt;chr&gt; NA
## $ monitorType           &lt;chr&gt; NA
## $ siteID                &lt;chr&gt; "530470009"
## $ instrumentID          &lt;chr&gt; "01"
## $ aqsID                 &lt;chr&gt; "530470009"
## $ pwfslID               &lt;chr&gt; NA
## $ pwfslDataIngestSource &lt;chr&gt; "AIRNOW"
## $ telemetryAggregator   &lt;chr&gt; NA
## $ telemetryUnitID       &lt;chr&gt; NA</code></pre>
<p>We can use this spatial metadata for Twisp to find all sensors within 10 km.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load mvcaa pas file </span>
<span class="va">mvcaa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">archiveDir</span>, <span class="st">"mvcaa.rda"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Find sensors close to the "Twisp-Glover St" monitor</span>
<span class="va">Twisp_pas</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/pas_filterNear.html">pas_filterNear</a></span><span class="op">(</span>
  pas <span class="op">=</span> <span class="va">mvcaa</span>, 
  longitude <span class="op">=</span> <span class="op">-</span><span class="fl">120.1211</span>, 
  latitude <span class="op">=</span> <span class="fl">48.3645</span>, 
  radius <span class="op">=</span> <span class="st">"10 km"</span>
<span class="op">)</span>

<span class="va">Twisp_sensorIDs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/pas_getDeviceDeploymentIDs.html">pas_getDeviceDeploymentIDs</a></span><span class="op">(</span><span class="va">Twisp_pas</span><span class="op">)</span>

<span class="co"># Create a multi-sensor object for Twisp</span>
<span class="co"># NOTE:  The AirSensor package sensor_~() functions use a "filter" style syntax.</span>
<span class="va">Twisp_sensors</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../../reference/sensor_filterMeta.html">sensor_filterMeta</a></span><span class="op">(</span>
    <span class="va">mvcaa_sensors_fall</span>,
    <span class="va">deviceDeploymentID</span> <span class="op">%in%</span> <span class="va">Twisp_sensorIDs</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../../reference/sensor_filterDate.html">sensor_filterDate</a></span><span class="op">(</span>
    startdate <span class="op">=</span> <span class="fl">20200901</span>, 
    enddate <span class="op">=</span> <span class="fl">20201001</span>,
    timezone <span class="op">=</span> <span class="st">"America/Los_Angeles"</span>
  <span class="op">)</span>

<span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">Twisp_sensors</span><span class="op">$</span><span class="va">meta</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 4
## Columns: 35
## $ ID                               &lt;chr&gt; "13669", "10182", "39237", "10168"
## $ label                            &lt;chr&gt; "MV Clean Air Ambassador @ Balky Hil…
## $ sensorType                       &lt;chr&gt; "PMS5003+PMS5003+BME280", "PMS5003+P…
## $ DEVICE_LOCATIONTYPE              &lt;chr&gt; "outside", "outside", "outside", "ou…
## $ THINGSPEAK_PRIMARY_ID            &lt;chr&gt; "546462", "488150", "867178", "48812…
## $ THINGSPEAK_PRIMARY_ID_READ_KEY   &lt;chr&gt; "IED4YX3BZ1L6BFNV", "FO9OY4N1IBCRCV0…
## $ THINGSPEAK_SECONDARY_ID          &lt;chr&gt; "546463", "488151", "867179", "48812…
## $ THINGSPEAK_SECONDARY_ID_READ_KEY &lt;chr&gt; "ZI005QWNICOEGP2I", "4K9BD1JKVIH00RZ…
## $ longitude                        &lt;dbl&gt; -120.1074, -120.0393, -120.1698, -12…
## $ latitude                         &lt;dbl&gt; 48.37780, 48.29690, 48.44244, 48.394…
## $ countryCode                      &lt;chr&gt; "US", "US", "US", "US"
## $ stateCode                        &lt;chr&gt; "WA", "WA", "WA", "WA"
## $ timezone                         &lt;chr&gt; "America/Los_Angeles", "America/Los_…
## $ deviceID                         &lt;chr&gt; "13669", "10182", "39237", "10168"
## $ locationID                       &lt;chr&gt; "ab5dca99422f2c0d", "f6c44edd41c941c…
## $ deviceDeploymentID               &lt;chr&gt; "ab5dca99422f2c0d_13669", "f6c44edd4…
## $ pwfsl_closestDistance            &lt;dbl&gt; 2641.011, 8017.898, 4163.514, 6344.5…
## $ pwfsl_closestMonitorID           &lt;chr&gt; "840530470016_01", "840530470016_01"…
## $ sensorManufacturer               &lt;chr&gt; "Purple Air", "Purple Air", "Purple …
## $ targetPollutant                  &lt;chr&gt; "PM", "PM", "PM", "PM"
## $ technologyType                   &lt;chr&gt; "consumer-grade", "consumer-grade", …
## $ communityRegion                  &lt;chr&gt; NA, NA, NA, NA
## $ monitorID                        &lt;chr&gt; "ab5dca99422f2c0d_13669", "f6c44edd4…
## $ elevation                        &lt;dbl&gt; NA, NA, NA, NA
## $ siteName                         &lt;chr&gt; "MV Clean Air Ambassador @ Balky Hil…
## $ countyName                       &lt;chr&gt; NA, NA, NA, NA
## $ msaName                          &lt;chr&gt; NA, NA, NA, NA
## $ monitorType                      &lt;chr&gt; "PMS5003+PMS5003+BME280", "PMS5003+P…
## $ siteID                           &lt;chr&gt; "ab5dca99422f2c0d", "f6c44edd41c941c…
## $ instrumentID                     &lt;chr&gt; "13669", "10182", "39237", "10168"
## $ aqsID                            &lt;chr&gt; NA, NA, NA, NA
## $ pwfslID                          &lt;chr&gt; NA, NA, NA, NA
## $ pwfslDataIngestSource            &lt;chr&gt; "ThingSpeak", "ThingSpeak", "ThingSp…
## $ telemetryAggregator              &lt;chr&gt; NA, NA, NA, NA
## $ telemetryUnitID                  &lt;chr&gt; NA, NA, NA, NA</code></pre>
<p>It is important to understand that hourly aggregated <em>airsensor</em> objects from the <strong>AirSensor</strong> package are compatible with <em>monitor</em> objects from the <strong>PWFSLSmoke</strong> package. Because of this, we can combine both into a single object for plotting.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Combine "monitor" and PA-derived "airsensor" objects</span>
<span class="va">Twisp</span> <span class="op">&lt;-</span> <span class="fu">PWFSLSmoke</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PWFSLSmoke/man/monitor_combine.html">monitor_combine</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">Twisp_monitor</span>, <span class="va">Twisp_sensors</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Print out the the names</span>
<span class="va">Twisp</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">siteName</span></code></pre></div>
<pre><code>## [1] "Twisp-Glover St"                                   
## [2] "MV Clean Air Ambassador @ Balky Hill"              
## [3] "MV Clean Air Ambassador @ Benson Creek"            
## [4] "MV Clean Air Ambassador @ Liberty Bell High School"
## [5] "MV Clean Air Ambassador @ Upper Beaver Creek"</code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Help ggplot out by assigning short names to be used as the facet label</span>
<span class="va">Twisp</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">shortName</span> <span class="op">&lt;-</span>
  <span class="va">Twisp</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">siteName</span> <span class="op">%&gt;%</span>
  <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="st">"MV Clean Air Ambassador @"</span>, <span class="st">""</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="st">"MV Clean Air Ambassador-"</span>, <span class="st">""</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_trim</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># The followingn functions are from the AirMonitorPlots package</span>
<span class="fu"><a href="https://rdrr.io/pkg/AirMonitorPlots/man/ggplot_pm25Timeseries.html">ggplot_pm25Timeseries</a></span><span class="op">(</span><span class="va">Twisp</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/AirMonitorPlots/man/stat_dailyAQCategory.html">stat_dailyAQCategory</a></span><span class="op">(</span>timezone <span class="op">=</span> <span class="st">"America/Los_Angeles"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">shortName</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="MVCAA_Tutorial_6_files/figure-html/dailyBarplot-1.png" width="672"></p>
<p>We can see that the Twisp-Glover St. monitor recorded increasing PM2.5 concentrations up to very unhealthy levels (purple) between Sep 10 and 19 and that three out of four sensors within a radius of 10 km from the monitor don’t show data during the smokiest days.</p>
<p>The default QC algorithm <a href="https://mazamascience.github.io/AirSensor/reference/PurpleAirQC_hourly_AB_01.html">AB_01</a> that was used by <code><a href="../../reference/pat_createAirSensor.html">pat_createAirSensor()</a></code> in Tutorial 5 appears to be invalidating many hourly values on those days, presumably because the A and B channel PM2.5 values differ by more than is allowed by that algorithm.</p>
<p>We can address this problem by creating a new sensor object for each senso using the QC algorithm <a href="https://mazamascience.github.io/AirSensor/reference/PurpleAirQC_hourly_AB_00.html">AB_00</a> which is more forgiving of A/B channel differences.</p>
<p>But first, let’s explore the raw data by running <code><a href="../../reference/pat_internalFit.html">pat_internalFit()</a></code> for a quick assessment of the raw data for each of our sensors.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#--------------- pat internal fits----------------------------------------------</span>
<span class="va">Balky_Hill</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/pat_loadMonth.html">pat_loadMonth</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="st">"ab5dca99422f2c0d_13669"</span>,
  datestamp <span class="op">=</span> <span class="fl">202009</span>,
  timezone <span class="op">=</span> <span class="st">"America/Los_Angeles"</span>
<span class="op">)</span>
<span class="fu"><a href="../../reference/pat_internalFit.html">pat_internalFit</a></span><span class="op">(</span><span class="va">Balky_Hill</span><span class="op">)</span></code></pre></div>
<p><img src="MVCAA_Tutorial_6_files/figure-html/pat_internalFit-1.png" width="672"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Benson_Creek</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/pat_loadMonth.html">pat_loadMonth</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="st">"f6c44edd41c941c7_10182"</span>,
  datestamp <span class="op">=</span> <span class="fl">202009</span>,
  timezone <span class="op">=</span> <span class="st">"America/Los_Angeles"</span>
<span class="op">)</span>
  
<span class="fu"><a href="../../reference/pat_internalFit.html">pat_internalFit</a></span><span class="op">(</span><span class="va">Benson_Creek</span><span class="op">)</span></code></pre></div>
<p><img src="MVCAA_Tutorial_6_files/figure-html/pat_internalFit-2.png" width="672"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Liberty_Bell_HS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/pat_loadMonth.html">pat_loadMonth</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="st">"db5d6b3b79f5830e_39237"</span>,
  datestamp <span class="op">=</span> <span class="fl">202009</span>,
  timezone <span class="op">=</span> <span class="st">"America/Los_Angeles"</span>
<span class="op">)</span>

<span class="fu"><a href="../../reference/pat_internalFit.html">pat_internalFit</a></span><span class="op">(</span><span class="va">Liberty_Bell_HS</span><span class="op">)</span></code></pre></div>
<p><img src="MVCAA_Tutorial_6_files/figure-html/pat_internalFit-3.png" width="672"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Upper_Beaver_Creek</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/pat_loadMonth.html">pat_loadMonth</a></span><span class="op">(</span>
  id <span class="op">=</span> <span class="st">"2e3b5ceea86a885b_10168"</span>,
  datestamp <span class="op">=</span> <span class="fl">202009</span>,
  timezone <span class="op">=</span> <span class="st">"America/Los_Angeles"</span>
<span class="op">)</span>

<span class="fu"><a href="../../reference/pat_internalFit.html">pat_internalFit</a></span><span class="op">(</span><span class="va">Upper_Beaver_Creek</span><span class="op">)</span></code></pre></div>
<p><img src="MVCAA_Tutorial_6_files/figure-html/pat_internalFit-4.png" width="672"></p>
<p>Given the thousands of observations included in each data set, we would expect internal fits with an r-squared value of &gt;= 0.99 and a slope of ~ 1 for sensors that functioned perfectly.</p>
<p>The internal fit plots show that all sensors did quite a good job at measuring the PM25 concentrations. Benson Creek sensor had multiple days with missing data and Upper Beaver Creek showed some A/B mismatch during the thickest smoke but. But A and B channels tracked eachother well (r-squared) for all sensors.</p>
<p>Now we can compare each sensor against the Twisp monitor with the <code><a href="../../reference/pat_externalFit.html">pat_externalFit()</a></code> function.</p>
<p><em>NOTE</em>: Looking at the <code>$meta</code> of each <code>pat</code> object, we see that the current nearest monitor is different from the monitor that collected PM2.5 concentrations during September 2020. For this reason, we are going to edit the <code>$meta</code> of each <code>pat</code> object and replace the current <code>pwfsl_closestMonitorID</code> with the one active in September 2020.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># First, substitute the current closest monitor with the 2020 Twisp</span>
<span class="co"># monitor ID. </span>

<span class="co"># Check the current closest monitor </span>
<span class="va">Balky_Hill</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">pwfsl_closestMonitorID</span> <span class="co">#"840530470016_01"</span></code></pre></div>
<pre><code>## [1] "840530470016_01"</code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Assign the Twisp monitor ID to pwfsl_closestMonitorID </span>
<span class="va">Balky_Hill</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">pwfsl_closestMonitorID</span> <span class="op">&lt;-</span> <span class="st">"530470009_01"</span>
<span class="va">Benson_Creek</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">pwfsl_closestMonitorID</span> <span class="op">&lt;-</span> <span class="st">"530470009_01"</span>
<span class="va">Liberty_Bell_HS</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">pwfsl_closestMonitorID</span> <span class="op">&lt;-</span> <span class="st">"530470009_01"</span>
<span class="va">Upper_Beaver_Creek</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">pwfsl_closestMonitorID</span> <span class="op">&lt;-</span> <span class="st">"530470009_01"</span>

<span class="co"># Twisp ~ Balky_Hill</span>
<span class="va">lm_BH</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/pat_externalFit.html">pat_externalFit</a></span><span class="op">(</span>
  pat <span class="op">=</span> <span class="va">Balky_Hill</span>,
  showPlot <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<p><img src="MVCAA_Tutorial_6_files/figure-html/pat_externalFit-1.png" width="672"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Twisp ~ Benson_Creek</span>
<span class="va">lm_BC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/pat_externalFit.html">pat_externalFit</a></span><span class="op">(</span>
  pat <span class="op">=</span> <span class="va">Benson_Creek</span>,
  showPlot <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<p><img src="MVCAA_Tutorial_6_files/figure-html/pat_externalFit-2.png" width="672"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Twisp ~ Liberty_Bell_HS</span>
<span class="va">lm_LBHS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/pat_externalFit.html">pat_externalFit</a></span><span class="op">(</span>
  pat <span class="op">=</span> <span class="va">Liberty_Bell_HS</span>,
  showPlot <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<p><img src="MVCAA_Tutorial_6_files/figure-html/pat_externalFit-3.png" width="672"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># distance: 4.2 km</span>
<span class="co"># fit: 0.901 (missing days)</span>

<span class="co"># Twisp ~ Upper_Beaver_Creek</span>
<span class="va">lm_UBC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/pat_externalFit.html">pat_externalFit</a></span><span class="op">(</span>
  pat <span class="op">=</span> <span class="va">Upper_Beaver_Creek</span>,
  showPlot <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<p><img src="MVCAA_Tutorial_6_files/figure-html/pat_externalFit-4.png" width="672"></p>
<p>When compared to the Twisp monitor data, the external fit plots show that Balky Hill was the one performing best, followed by Liberty Bell High School, and Upper Beaver Creek (we are not considering Benson Creek due to the substantial missing data during the smokiest days).</p>
<p>Linear fits comparing sensor data with nearby monitor data will should at least have an r-squared value &gt; 0.8 to be considered <em>reasonable</em>.</p>
<p>We will make the executive decision that all of these sensors are performing acceptably and will use the more lenient AB_00 Quality Control algorithm to create <em>airsensor</em> objects that retain more data.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#--- create sensor objects using AB_00 ----</span>
<span class="va">BH_00</span> <span class="op">&lt;-</span> 
  <span class="va">Balky_Hill</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../../reference/pat_createAirSensor.html">pat_createAirSensor</a></span><span class="op">(</span>
    FUN <span class="op">=</span> <span class="va">PurpleAirQC_hourly_AB_00</span>
  <span class="op">)</span>

<span class="va">BC_00</span> <span class="op">&lt;-</span> 
  <span class="va">Benson_Creek</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../../reference/pat_createAirSensor.html">pat_createAirSensor</a></span><span class="op">(</span>
    FUN <span class="op">=</span> <span class="va">PurpleAirQC_hourly_AB_00</span>
  <span class="op">)</span>

<span class="va">LBHS_00</span> <span class="op">&lt;-</span> 
  <span class="va">Liberty_Bell_HS</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../../reference/pat_createAirSensor.html">pat_createAirSensor</a></span><span class="op">(</span>
    FUN <span class="op">=</span> <span class="va">PurpleAirQC_hourly_AB_00</span>
  <span class="op">)</span>

<span class="va">UBC_00</span> <span class="op">&lt;-</span> 
  <span class="va">Upper_Beaver_Creek</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../../reference/pat_createAirSensor.html">pat_createAirSensor</a></span><span class="op">(</span>
    FUN <span class="op">=</span> <span class="va">PurpleAirQC_hourly_AB_00</span>
  <span class="op">)</span>

<span class="co"># combine sensors and monitor </span>
<span class="va">Twisp_00</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/PWFSLSmoke/man/monitor_combine.html">monitor_combine</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">BH_00</span>, <span class="va">BC_00</span>, <span class="va">LBHS_00</span>, <span class="va">UBC_00</span>, <span class="va">Twisp_monitor</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>When it comes to external fits, it is important to consider geographic features such as distance and topography. Indeed, topography affects air movement and therefore PM25 concentrations, having an effect on the external fit results. A shorter distance between sensor and monitor <em>should</em> result in a better fit as long as both are at a similar elevation.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a leaflet map </span>
<span class="fu"><a href="https://rdrr.io/pkg/PWFSLSmoke/man/monitor_leaflet.html">monitor_leaflet</a></span><span class="op">(</span><span class="va">Twisp_00</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-d7d0e02e28a426226c1a" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-d7d0e02e28a426226c1a">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"setView":[[48.369672,-120.1045505],11,[]],"calls":[{"method":"addProviderTiles","args":["Esri.WorldTopoMap",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addCircleMarkers","args":[[48.377799,48.296902,48.442442,48.394428,48.3645],[-120.107424,-120.039328,-120.169773,-120.04445,-120.1211],10,null,null,{"interactive":true,"className":"","stroke":false,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":["#7E0023","#7E0023","#7E0023","#7E0023","#8F3F97"],"fillOpacity":0.7},null,null,["siteName: MV Clean Air Ambassador @ Balky Hill<br>monitorID: ab5dca99422f2c0d_13669<br>elevation: NA<br>pm25: 273.5<br>","siteName: MV Clean Air Ambassador @ Benson Creek<br>monitorID: f6c44edd41c941c7_10182<br>elevation: NA<br>pm25: 301.2<br>","siteName: MV Clean Air Ambassador @ Liberty Bell High School<br>monitorID: db5d6b3b79f5830e_39237<br>elevation: NA<br>pm25: 320.6<br>","siteName: MV Clean Air Ambassador @ Upper Beaver Creek<br>monitorID: 2e3b5ceea86a885b_10168<br>elevation: NA<br>pm25: 278.5<br>","siteName: Twisp-Glover St<br>monitorID: 530470009_01<br>elevation: 492<br>pm25: 215.7<br>"],null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLegend","args":[{"colors":["#7E0023","#8F3F97","#FF0000","#FF7E00","#FFFF00","#00E400"],"labels":["Hazardous","Very Unhealthy","Unhealthy","USG","Moderate","Good"],"na_color":null,"na_label":"NA","opacity":1,"position":"bottomright","type":"unknown","title":"AQI Level","extra":null,"layerId":null,"className":"info legend","group":null}]}],"limits":{"lat":[48.296902,48.442442],"lng":[-120.169773,-120.039328]}},"evals":[],"jsHooks":[]}</script><p>Looking at the map above we notice that Balky Hill is the closest sensor to the monitor in Twisp. We can also see that there are some significant hills separating Upper Beaver Creek from Twisp. Finally, Liberty Bell High School is the farthest sensor but the terrain between this and Twisp is flat.</p>
<p>Now that we have created new sensor objects with the AB_00 QC algorithm, we can recreate the daily barplots.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Help ggplot out by assigning short labels to be used as the facet label</span>
<span class="va">Twisp_00</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">shortName</span> <span class="op">&lt;-</span>
  <span class="va">Twisp_00</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">siteName</span> <span class="op">%&gt;%</span>
  <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="st">"MV Clean Air Ambassador @"</span>, <span class="st">""</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="st">"MV Clean Air Ambassador-"</span>, <span class="st">""</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_trim</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/AirMonitorPlots/man/ggplot_pm25Timeseries.html">ggplot_pm25Timeseries</a></span><span class="op">(</span><span class="va">Twisp_00</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/AirMonitorPlots/man/stat_dailyAQCategory.html">stat_dailyAQCategory</a></span><span class="op">(</span>timezone <span class="op">=</span> <span class="st">"America/Los_Angeles"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">shortName</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="MVCAA_Tutorial_6_files/figure-html/dailyBarplot-sensors-AB00-1.png" width="672"> These plots confirm that, initially, the sensors’ data was invalidated by the QC algorithm AB_01. By applying the QC algorithm AB_00, it is possible to retain more hourly values and produce a plot which better represents the data collected by the PurpleAir sensors. These sensors agree quite well with the measurements made by the regulatory monitor.</p>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>PA sensors can provide useful information when evaluate PM2.5 concentrations but require a careful assessment to understand whether they are working properly. As we saw in previous tutorials, the <strong>AirSensor</strong> package offers functions to assess the state of heath of sensors, including variables such as temperature and humidity. The package also includes functions to evaluate, manipulate, visualize and map the data.</p>
<p>In this tutorial, we demonstrated how to quickly investigate the performance of multiple sensors, how to trouble shoot and fix potential issues, and how to interpret and visualize the data with simple plots.</p>
<p>At the end of the day, it’s up to the individual to decide which QC algorithm to apply and which sensors to include in your study. These decisions cannot yet be automated and must be based on overall sensor performance, a review of days with missing data, internal and external fits, and consideration of the terrain features.</p>
<p><em>Best of luck assessing air quality in your community!</em></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jonathan Callahan, Hans Martin, Kayleigh Wilson, Tate Brasel, Helen Miller.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
