<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MVCAA Tutorial 5: Building a Local Archive • AirSensor</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="MVCAA Tutorial 5: Building a Local Archive">
<meta property="og:description" content="AirSensor">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">AirSensor</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/AirSensor_Function_Overview.html">AirSensor Function Overview</a>
    </li>
    <li>
      <a href="../../articles/Developer_Style_Guide.html">Developer Style Guide</a>
    </li>
    <li>
      <a href="../../articles/articles/Australia_on_fire.html">Australia on Fire</a>
    </li>
    <li>
      <a href="../../articles/articles/Custom_QC_Algorithms.html">Custom QC Algorithms</a>
    </li>
    <li>
      <a href="../../articles/articles/DataFlowChart.html">Processing PurpleAir Data</a>
    </li>
    <li>
      <a href="../../articles/articles/MVCAA_Tutorial_1.html">MVCAA Tutorial 1: Creating PAT Data</a>
    </li>
    <li>
      <a href="../../articles/articles/MVCAA_Tutorial_2.html">MVCAA Tutorial 2: Exploring PAT Data</a>
    </li>
    <li>
      <a href="../../articles/articles/MVCAA_Tutorial_3.html">MVCAA Tutorial 3: Creating Airsensor Data</a>
    </li>
    <li>
      <a href="../../articles/articles/MVCAA_Tutorial_4.html">MVCAA Tutorial 4: Exploring Airsensor Data</a>
    </li>
    <li>
      <a href="../../articles/articles/MVCAA_Tutorial_5.html">MVCAA Tutorial 5: Building a Local Archive</a>
    </li>
    <li>
      <a href="../../articles/articles/MVCAA_Tutorial_6.html">MVCAA Tutorial 6: Methow Vallely Smoke</a>
    </li>
    <li>
      <a href="../../articles/articles/SoH_functions.html">SoH Functions</a>
    </li>
    <li>
      <a href="../../articles/articles/Temporal_Aggregation.html">Temporally Aggregated Time Series</a>
    </li>
    <li>
      <a href="../../articles/articles/outlier_detection.html">Outlier Detection with the Hampel Filter</a>
    </li>
    <li>
      <a href="../../articles/articles/pas_introduction.html">PurpleAir Synoptic Data</a>
    </li>
    <li>
      <a href="../../articles/articles/pat_introduction.html">PurpleAir Time Series Data</a>
    </li>
    <li>
      <a href="../../articles/articles/purpleair_failure_modes.html">PurpleAir Failure Modes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MazamaScience/AirSensor/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="MVCAA_Tutorial_5_files/header-attrs-2.5/header-attrs.js"></script><link href="MVCAA_Tutorial_5_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="MVCAA_Tutorial_5_files/anchor-sections-1.0/anchor-sections.js"></script><script src="MVCAA_Tutorial_5_files/htmlwidgets-1.5.3/htmlwidgets.js"></script><script src="MVCAA_Tutorial_5_files/jquery-1.12.4/jquery.min.js"></script><link href="MVCAA_Tutorial_5_files/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="MVCAA_Tutorial_5_files/leaflet-1.3.1/leaflet.js"></script><link href="MVCAA_Tutorial_5_files/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="MVCAA_Tutorial_5_files/proj4-2.6.2/proj4.min.js"></script><script src="MVCAA_Tutorial_5_files/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="MVCAA_Tutorial_5_files/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="MVCAA_Tutorial_5_files/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="MVCAA_Tutorial_5_files/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="MVCAA_Tutorial_5_files/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>MVCAA Tutorial 5: Building a Local Archive</h1>
                        <h4 class="author">Mazama Science</h4>
            
            <h4 class="date">2021-03-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MazamaScience/AirSensor/blob/master/vignettes/articles/MVCAA_Tutorial_5.Rmd"><code>vignettes/articles/MVCAA_Tutorial_5.Rmd</code></a></small>
      <div class="hidden name"><code>MVCAA_Tutorial_5.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This tutorial demonstrates how to create a multi-month archive of PurpleAir timeseries data that can be loaded from a local <code>archiveBaseDir</code>. Where Tutorial 1 demonstrated how to save and work with a small number of sensors for a single month, this tutorial provides a more organized approach for working with larger networks of sensors over extended periods of time. Target audiences include grad students, researchers and any member of the public concerned about air quality and comfortable working with R and RStudio.</p>
<p>Tutorials in this series include:</p>
<ul>
<li><a href="https://mazamascience.github.io/AirSensor/articles/articles/MVCAA_Tutorial_1.html">MVCAA Tutorial 1: Creating PAT Data</a></li>
<li><a href="https://mazamascience.github.io/AirSensor/articles/articles/MVCAA_Tutorial_2.html">MVCAA Tutorial 2: Exploring PAT Data</a></li>
<li><a href="https://mazamascience.github.io/AirSensor/articles/articles/MVCAA_Tutorial_3.html">MVCAA Tutorial 3: Creating Airsensor Data</a></li>
<li><a href="https://mazamascience.github.io/AirSensor/articles/articles/MVCAA_Tutorial_4.html">MVCAA Tutorial 4: Exploring Airsensor Data</a></li>
<li><a href="https://mazamascience.github.io/AirSensor/articles/articles/MVCAA_Tutorial_5.html">MVCAA Tutorial 5: Building a Local Archive</a></li>
<li><a href="https://mazamascience.github.io/AirSensor/articles/articles/MVCAA_Tutorial_6.html">MVCAA Tutorial 6: Methow Vallely Smoke</a></li>
</ul>
</div>
<div id="goal" class="section level2">
<h2 class="hasAnchor">
<a href="#goal" class="anchor"></a>Goal</h2>
<p>The goal in this tutorial is to explain the file naming protocol and directory structure required for data to be loaded using the <code><a href="../../reference/pat_load.html">pat_load()</a></code> and <code><a href="../../reference/sensor_load.html">sensor_load()</a></code> functions. We will build a multi-month archive for the Methow Valley and demonstrate accessing that data.</p>
</div>
<div id="directory-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#directory-structure" class="anchor"></a>Directory Structure</h2>
<p>The <em>AirSensor</em> package has a variety of “load” functions, all of which assume that pre-generated data files will be found in specific locations underneath an archive directory. The base of this directory is specified by <code><a href="../../reference/setArchiveBaseUrl.html">setArchiveBaseUrl()</a></code> if the archive is web based or <code><a href="../../reference/setArchiveBaseDir.html">setArchiveBaseDir()</a></code> if the archive is local.</p>
<p>For a multi-year archive, the overall structure beneath the <code>archiveBaseDir</code> will look something like this, depending on how many years of data you have:</p>
<pre><code>├── airsensor
│   ├── 2020
│   ├── 2021
│   └── latest
├── pas
│   ├── 2020
│   └── 2021
├── pat
│   ├── 2019
│   │   ├── 01
│   │   ├── ...
│   │   └── 12
│   ├── 2020
│   │   ├── 01
│   │   ├── ...
│   │   └── 12
│   ├── 2021
│   │   ├── 01
│   │   ├── 02
│   │   └── 03
│   └── latest</code></pre>
</div>
<div id="file-naming-protocol" class="section level2">
<h2 class="hasAnchor">
<a href="#file-naming-protocol" class="anchor"></a>File Naming Protocol</h2>
<p>The protocol for creating pre-generated edata files depends on the type of object being created.</p>
<div id="airsensor" class="section level3">
<h3 class="hasAnchor">
<a href="#airsensor" class="anchor"></a>airsensor</h3>
<ul>
<li>Directory: <code>&lt;archiveBaseDir&gt;/airsensor/&lt;YYYY&gt;/</code>
</li>
<li>File name: <code>airsensor_&lt;collectionName&gt;_&lt;YYYYMM&gt;.rda</code>
</li>
<li>Example: <code>~/Data/MVCAA/airsensor/2020/airsensor_mvcaa_202009.rda</code>
</li>
</ul>
<p><em>NOTE:</em> <code>&lt;collectionName&gt;</code> is an arbitrary character string defined by the user.</p>
</div>
<div id="pas" class="section level3">
<h3 class="hasAnchor">
<a href="#pas" class="anchor"></a>pas</h3>
<ul>
<li>Directory: <code>&lt;archiveBaseDir&gt;/pas/&lt;YYYY&gt;/</code>
</li>
<li>File name: <code>pas_&lt;YYYYMMDD&gt;.rda</code>
</li>
<li>Example: <code>~/Data/MVCAA/pas/2020/pas_20200901.rda</code>
</li>
</ul>
<p><em>NOTE:</em> We won’t use the archive directories for the pas object because we already have exactly what we want in our <code>mvcaa.rda</code> file.</p>
</div>
<div id="pat" class="section level3">
<h3 class="hasAnchor">
<a href="#pat" class="anchor"></a>pat</h3>
<ul>
<li>Directory: <code>&lt;archiveBaseDir&gt;/pas/&lt;YYYY&gt;/&lt;MM&gt;/</code>
</li>
<li>File name: <code>pat_&lt;deviceDeploymentID&gt;_&lt;YYYYMM&gt;.rda</code>
</li>
<li>Example: <code>~/Data/MVCAA/pat/2020/09/pat_ab5dca99422f2c0d_13669__202009.rda</code>
</li>
</ul>
</div>
</div>
<div id="load-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#load-functions" class="anchor"></a>_load() Functions</h2>
<p>When loading data, package <code>~_load()</code> functions look for any local archive specified with <code><a href="../../reference/setArchiveBaseDir.html">setArchiveBaseDir()</a></code>. If no local archive is found, a web based archive is searched at the URL specified with <code><a href="../../reference/setArchiveBaseUrl.html">setArchiveBaseUrl()</a></code>. Mazama Science maintains a small archive of data associated with the South Coast Air Quality Management District at: <a href="https://airsensor.aqmd.gov/PurpleAir/v1/" class="uri">https://airsensor.aqmd.gov/PurpleAir/v1/</a>.</p>
<p>Package functions that load pre-generated data files include:</p>
<ul>
<li><code><a href="../../reference/pas_load.html">pas_load()</a></code></li>
<li><code><a href="../../reference/pat_load.html">pat_load()</a></code></li>
<li><code><a href="../../reference/pat_loadLatest.html">pat_loadLatest()</a></code></li>
<li><code>pat_loadMM()</code></li>
<li><code><a href="../../reference/sensor_load.html">sensor_load()</a></code></li>
<li><code><a href="../../reference/sensor_loadLatest.html">sensor_loadLatest()</a></code></li>
<li><code>sensor_loadMM()</code></li>
</ul>
<p>To avoid internet latency, specification of <code>archiveBaseDir</code> will always take precedence over specification of <code>archiveBaseUrl</code>. For this reason, if you previously set <code>archiveBaseDir</code> and you then want to load data from some <code>archiveBaseUrl</code>, you will have to first: <code><a href="../../reference/setArchiveBaseDir.html">setArchiveBaseDir(NULL)</a></code>.</p>
</div>
<div id="r-script" class="section level2">
<h2 class="hasAnchor">
<a href="#r-script" class="anchor"></a>R script</h2>
<p>The following R script will take several minutes to run and will create an archive of ‘pat’ and ‘airsensor’ data files on your computer. Once these files have been created, loading them will be very fast.</p>
<p>After running the script, a final section will demonstrate how to load and work with these local data files.</p>
<p>This R script can be used as a starting point for anyone interested in creating small collections of data for other communities and other dates.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Methow Valley local data archive: Setup</span>

<span class="co"># NOTE:  https://mazamascience.github.io/MazamaCoreUtils/articles/logging.html</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MazamaScience/MazamaCoreUtils">MazamaCoreUtils</a></span><span class="op">)</span>    <span class="co"># for logging</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MazamaScience/AirSensor">AirSensor</a></span><span class="op">)</span>

<span class="co"># ----- Setup ------------------------------------------------------------------</span>

<span class="co"># Have log messages sent to the console</span>
<span class="fu">MazamaCoreUtils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MazamaCoreUtils/man/logger.setLevel.html">logger.setLevel</a></span><span class="op">(</span><span class="va">TRACE</span><span class="op">)</span>

<span class="co"># Use the default archiveDir unless it is already defined</span>
<span class="kw">if</span> <span class="op">(</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"archiveDir"</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span>
  <span class="va">archiveDir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"~/Data/MVCAA"</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Set the package archiveBaseDir so we can load pat objects with `pat_load()`</span>
<span class="fu"><a href="../../reference/setArchiveBaseDir.html">setArchiveBaseDir</a></span><span class="op">(</span><span class="va">archiveDir</span><span class="op">)</span>

<span class="co"># ----- Get PAS object ---------------------------------------------------------</span>

<span class="co"># NOTE:  We won't use the archive directories for the pas object because we</span>
<span class="co"># NOTE:  already have exactly what we want in our `mvcaa.rda` file.</span>

<span class="va">mvcaa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">archiveDir</span>, <span class="st">"mvcaa.rda"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># ----- Prepare PAT info -------------------------------------------------------</span>

<span class="co"># Get all the deviceDeploymentIDs</span>
<span class="va">mvcaa_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/pas_getDeviceDeploymentIDs.html">pas_getDeviceDeploymentIDs</a></span><span class="op">(</span><span class="va">mvcaa</span><span class="op">)</span>

<span class="co"># Set up months</span>
<span class="va">timezone</span> <span class="op">&lt;-</span> <span class="st">"America/Los_Angeles"</span>
<span class="va">monthStamps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">202009</span>, <span class="fl">202010</span>, <span class="fl">202011</span><span class="op">)</span>

<span class="co"># Loop over months</span>
<span class="kw">for</span> <span class="op">(</span> <span class="va">monthStamp</span> <span class="kw">in</span> <span class="va">monthStamps</span> <span class="op">)</span> <span class="op">{</span>

  <span class="fu"><a href="https://rdrr.io/pkg/MazamaCoreUtils/man/logger.debug.html">logger.debug</a></span><span class="op">(</span><span class="st">"Working on monthStamp %s ---------- ..."</span>, <span class="va">monthStamp</span><span class="op">)</span> 
  
  <span class="co"># Get POSXct startdate</span>
  <span class="va">startdate</span> <span class="op">&lt;-</span> <span class="fu">MazamaCoreUtils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MazamaCoreUtils/man/parseDatetime.html">parseDatetime</a></span><span class="op">(</span><span class="va">monthStamp</span>, timezone <span class="op">=</span> <span class="va">timezone</span><span class="op">)</span>
  
  <span class="co"># Guarantee that the enddate is the first of the next month</span>
  <span class="va">enddate</span> <span class="op">&lt;-</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span>
    <span class="va">startdate</span> <span class="op">+</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/duration.html">ddays</a></span><span class="op">(</span><span class="fl">40</span><span class="op">)</span>,
    unit <span class="op">=</span> <span class="st">"month"</span>
  <span class="op">)</span>
  
  <span class="co"># Get YYYY and MM strings</span>
  <span class="va">YYYY</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strptime.html">strftime</a></span><span class="op">(</span><span class="va">startdate</span>, <span class="st">"%Y"</span><span class="op">)</span>
  <span class="va">MM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strptime.html">strftime</a></span><span class="op">(</span><span class="va">startdate</span>, <span class="st">"%m"</span><span class="op">)</span>
  
  <span class="co"># Initialize counters</span>
  <span class="va">idCount</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mvcaa_ids</span><span class="op">)</span>
  <span class="va">count</span> <span class="op">&lt;-</span> <span class="fl">0</span> 
  <span class="va">successCount</span> <span class="op">&lt;-</span> <span class="fl">0</span>
  
  <span class="co"># ----- Create PAT objects ---------------------------------------------------</span>

  <span class="co"># Create the archiveDir/pat/YYYY/MM/ directory</span>
  <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">archiveDir</span>, <span class="st">"pat"</span>, <span class="va">YYYY</span>, <span class="va">MM</span><span class="op">)</span>, 
    showWarnings <span class="op">=</span> <span class="cn">FALSE</span>,
    recursive <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>
  
  <span class="co"># Loop over all deviceDeploymentIDs</span>
  <span class="kw">for</span> <span class="op">(</span> <span class="va">id</span> <span class="kw">in</span> <span class="va">mvcaa_ids</span> <span class="op">)</span> <span class="op">{</span>

    <span class="co"># Create PAT canonical file name</span>
    <span class="va">fileName</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"pat_"</span>, <span class="va">id</span>, <span class="st">"_"</span>, <span class="va">YYYY</span>, <span class="va">MM</span>, <span class="st">".rda"</span><span class="op">)</span>

    <span class="co"># Create PAT canonical file path</span>
    <span class="va">filePath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">archiveDir</span>, <span class="st">"pat"</span>, <span class="va">YYYY</span>, <span class="va">MM</span>, <span class="va">fileName</span><span class="op">)</span>

    <span class="va">count</span> <span class="op">&lt;-</span> <span class="va">count</span> <span class="op">+</span> <span class="fl">1</span>
    <span class="fu"><a href="https://rdrr.io/pkg/MazamaCoreUtils/man/logger.debug.html">logger.debug</a></span><span class="op">(</span><span class="st">"Working on %s (%d/%d) ..."</span>, <span class="va">id</span>, <span class="va">count</span>, <span class="va">idCount</span><span class="op">)</span>

    <span class="co"># Use a try-block in case you get "no data" errors</span>
    <span class="va">result</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="op">{</span>

      <span class="co"># Create PAT</span>
      <span class="va">pat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/pat_createNew.html">pat_createNew</a></span><span class="op">(</span>
        id <span class="op">=</span> <span class="va">id</span>,
        label <span class="op">=</span> <span class="cn">NULL</span>,        <span class="co"># not needed if you have the id</span>
        pas <span class="op">=</span> <span class="va">mvcaa</span>,
        startdate <span class="op">=</span> <span class="va">startdate</span>,
        enddate <span class="op">=</span> <span class="va">enddate</span>,
        timezone <span class="op">=</span> <span class="va">timezone</span>,
        baseUrl <span class="op">=</span> <span class="st">"https://api.thingspeak.com/channels/"</span>,
        verbose <span class="op">=</span> <span class="cn">FALSE</span>
      <span class="op">)</span>
      <span class="va">successCount</span> <span class="op">&lt;-</span> <span class="va">successCount</span> <span class="op">+</span> <span class="fl">1</span>
      <span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">pat</span>, file <span class="op">=</span> <span class="va">filePath</span><span class="op">)</span>

    <span class="op">}</span>, silent <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

    <span class="kw">if</span> <span class="op">(</span> <span class="st">"try-error"</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/pkg/MazamaCoreUtils/man/logger.error.html">logger.error</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/stop.html">geterrmessage</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span>

  <span class="op">}</span>
  
  <span class="co"># ------ Create AirSensor objects --------------------------------------------</span>
  
  <span class="co"># Create the archiveDir/airsensor/YYYY/ directory</span>
  <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">archiveDir</span>, <span class="st">"airsensor"</span>, <span class="va">YYYY</span><span class="op">)</span>, 
    showWarnings <span class="op">=</span> <span class="cn">FALSE</span>,
    recursive <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>
  
  <span class="co"># Assign a collection name that makes sense</span>
  <span class="va">collectionName</span> <span class="op">&lt;-</span> <span class="st">"mvcaa"</span>
  
  <span class="co"># Init counts</span>
  <span class="va">successCount</span> <span class="op">&lt;-</span> <span class="fl">0</span>
  <span class="va">count</span> <span class="op">&lt;-</span> <span class="fl">0</span>
  
  <span class="va">dataList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
  
  <span class="co"># Loop over all ids and aggregate to hourly</span>
  <span class="kw">for</span> <span class="op">(</span> <span class="va">id</span> <span class="kw">in</span> <span class="va">mvcaa_ids</span> <span class="op">)</span> <span class="op">{</span>
    
    <span class="va">count</span> <span class="op">&lt;-</span> <span class="va">count</span> <span class="op">+</span> <span class="fl">1</span>
    
    <span class="co"># Debug info</span>
    <span class="fu"><a href="https://rdrr.io/pkg/MazamaCoreUtils/man/logger.debug.html">logger.debug</a></span><span class="op">(</span>
      <span class="st">"%4d/%d Calling pat_createAirSensor('%s')"</span>,
      <span class="va">count</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mvcaa_ids</span><span class="op">)</span>,
      <span class="va">id</span>
    <span class="op">)</span>
    
    <span class="co"># Load the pat data, convert to an airsensor and add to dataList</span>
    <span class="va">dataList</span><span class="op">[[</span><span class="va">id</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span><span class="op">(</span>
      expr <span class="op">=</span> <span class="op">{</span>
        <span class="va">airsensor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/pat_load.html">pat_load</a></span><span class="op">(</span>
          id <span class="op">=</span> <span class="va">id</span>,
          label <span class="op">=</span> <span class="cn">NULL</span>,
          pas <span class="op">=</span> <span class="va">mvcaa</span>,
          startdate <span class="op">=</span> <span class="va">startdate</span>,
          enddate <span class="op">=</span> <span class="va">enddate</span>,
          timezone <span class="op">=</span> <span class="st">"America/Los_Angeles"</span>
        <span class="op">)</span> <span class="op">%&gt;%</span>
          <span class="fu"><a href="../../reference/pat_createAirSensor.html">pat_createAirSensor</a></span><span class="op">(</span>
            FUN <span class="op">=</span> <span class="fu">AirSensor</span><span class="fu">::</span><span class="va"><a href="../../reference/PurpleAirQC_hourly_AB_01.html">PurpleAirQC_hourly_AB_01</a></span>
          <span class="op">)</span>
      <span class="op">}</span>, 
      error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/pkg/MazamaCoreUtils/man/logger.warn.html">logger.warn</a></span><span class="op">(</span><span class="st">'Unable to load PAT data for %s '</span>, <span class="va">id</span><span class="op">)</span>
        <span class="cn">NULL</span>
      <span class="op">}</span>
      
      <span class="co"># Keep going in the face of errors</span>
    <span class="op">)</span>
    
  <span class="op">}</span> <span class="co"># END of deviceDeploymentIDs loop</span>
  
  <span class="co"># Combine the airsensors into a single airsensor object and save</span>
  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span><span class="op">(</span>
    expr <span class="op">=</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/pkg/MazamaCoreUtils/man/logger.info.html">logger.info</a></span><span class="op">(</span><span class="st">'Combining airsensors...'</span><span class="op">)</span>
      
      <span class="va">airsensor</span> <span class="op">&lt;-</span> <span class="fu">PWFSLSmoke</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PWFSLSmoke/man/monitor_combine.html">monitor_combine</a></span><span class="op">(</span><span class="va">dataList</span><span class="op">)</span>
      <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">airsensor</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"airsensor"</span>, <span class="st">"ws_monitor"</span>, <span class="st">"list"</span><span class="op">)</span>
      
      <span class="fu"><a href="https://rdrr.io/pkg/MazamaCoreUtils/man/logger.info.html">logger.info</a></span><span class="op">(</span><span class="st">'Combined successfully...'</span><span class="op">)</span>
      
      <span class="co"># Create Airsensor canonical file name</span>
      <span class="va">fileName</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"airsensor_"</span>, <span class="va">collectionName</span>, <span class="st">"_"</span>, <span class="va">YYYY</span>, <span class="va">MM</span>, <span class="st">".rda"</span><span class="op">)</span>
      
      <span class="co"># Create Airsensor canonical file path</span>
      <span class="va">filePath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">archiveDir</span>, <span class="st">"airsensor"</span>, <span class="va">YYYY</span>, <span class="va">fileName</span><span class="op">)</span>

      <span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span>list <span class="op">=</span> <span class="st">"airsensor"</span>, file <span class="op">=</span> <span class="va">filePath</span><span class="op">)</span>
    <span class="op">}</span>, 
    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">msg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Error creating monthly AirSensor file: "</span>, <span class="va">e</span><span class="op">)</span>
      <span class="fu"><a href="https://rdrr.io/pkg/MazamaCoreUtils/man/logger.error.html">logger.error</a></span><span class="op">(</span><span class="va">msg</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">)</span>

  <span class="co"># Now proceed to the next month</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="loading-local-data" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-local-data" class="anchor"></a>Loading Local Data</h2>
<p>Our local archive of data was created following the directory and file naming protocol. We can now work with this archive by running <code><a href="../../reference/setArchiveBaseDir.html">setArchiveBaseDir()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MazamaScience/AirSensor">AirSensor</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MazamaScience/AirMonitorPlots">AirMonitorPlots</a></span><span class="op">)</span>

<span class="co"># Use the tutorial default archiveDir unless it is already defined</span>
<span class="kw">if</span> <span class="op">(</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"archiveDir"</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span>
  <span class="va">archiveDir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"~/Data/MVCAA"</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Set your archive base directory and check that is correct</span>
<span class="fu"><a href="../../reference/setArchiveBaseDir.html">setArchiveBaseDir</a></span><span class="op">(</span><span class="va">archiveDir</span><span class="op">)</span>
<span class="fu"><a href="../../reference/getArchiveBaseDir.html">getArchiveBaseDir</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "~/Data/MVCAA"</code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load the custom pas file directly</span>
<span class="va">mvcaa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">archiveDir</span>, <span class="st">"mvcaa.rda"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Use the interactive map to quickly get the "deviceDeploymentID" of the sensors</span>
<span class="co"># you want to explore further based on their location. </span>
<span class="fu"><a href="../../reference/pas_leaflet.html">pas_leaflet</a></span><span class="op">(</span><span class="va">mvcaa</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-fa87c9dd7f8df52641ec" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-fa87c9dd7f8df52641ec">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"setView":[[48.381198,-120.2418335],10,[]],"calls":[{"method":"addProviderTiles","args":["Esri.WorldTopoMap",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addCircleMarkers","args":[[48.377799,48.296902,48.609412,48.519113,48.442442,48.485259,48.152984,48.525958,48.433301,48.394428,48.250318,48.551698,48.472146],[-120.107424,-120.039328,-120.444339,-120.240651,-120.169773,-120.174306,-120.082446,-120.173892,-120.245145,-120.04445,-120.11636,-120.257105,-120.178956],10,["MV Clean Air Ambassador @ Balky Hill","MV Clean Air Ambassador @ Benson Creek","MV Clean Air Ambassador @ Bush School","MV Clean Air Ambassador @ Gunn Ranch","MV Clean Air Ambassador @ Liberty Bell High School","MV Clean Air Ambassador @ Lower Studhorse","MV Clean Air Ambassador @ McFarland Creek ","MV Clean Air Ambassador @ Methow Estates","MV Clean Air Ambassador @ Pine Forest ","MV Clean Air Ambassador @ Upper Beaver Creek","MV Clean Air Ambassador @ Willowbrook Farm","MV Clean Air Ambassador-Little Cougar","MV Clean Air Ambassador@Little Star"],null,{"interactive":true,"className":"","stroke":false,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":["#00E400","#00E400","#00E400","#00E400","#00E400","#00E400","#00E400","#00E400","#00E400","#00E400","#00E400","#00E400","#00E400"],"fillOpacity":0.8},null,null,["<b>MV Clean Air Ambassador @ Balky Hill<\/b><br/><b>deviceDeploymentID = ab5dca99422f2c0d_13669<\/b><br/><b>pm25_1hr = 3 µg/m3<\/b><br/>temperature = 39 F<br/>humidity = 54%<br/>pm25_1hr = 3 µg/m3<br/>pm25_1day = 2.3 µg/m3<br/>location_type = outside<br/>","<b>MV Clean Air Ambassador @ Benson Creek<\/b><br/><b>deviceDeploymentID = f6c44edd41c941c7_10182<\/b><br/><b>pm25_1hr = 1.7 µg/m3<\/b><br/>temperature = 39 F<br/>humidity = 48%<br/>pm25_1hr = 1.7 µg/m3<br/>pm25_1day = 2.8 µg/m3<br/>location_type = outside<br/>","<b>MV Clean Air Ambassador @ Bush School<\/b><br/><b>deviceDeploymentID = 49215ad49d1a87e3_10188<\/b><br/><b>pm25_1hr = 11.3 µg/m3<\/b><br/>temperature = 41 F<br/>humidity = 49%<br/>pm25_1hr = 11.3 µg/m3<br/>pm25_1day = 3.5 µg/m3<br/>location_type = outside<br/>","<b>MV Clean Air Ambassador @ Gunn Ranch<\/b><br/><b>deviceDeploymentID = f736fd3fb21fc4da_13667<\/b><br/><b>pm25_1hr = 1.2 µg/m3<\/b><br/>temperature = 44 F<br/>humidity = 50%<br/>pm25_1hr = 1.2 µg/m3<br/>pm25_1day = 0.6 µg/m3<br/>location_type = outside<br/>","<b>MV Clean Air Ambassador @ Liberty Bell High School<\/b><br/><b>deviceDeploymentID = db5d6b3b79f5830e_39237<\/b><br/><b>pm25_1hr = 6.5 µg/m3<\/b><br/>temperature = 34 F<br/>humidity = 69%<br/>pm25_1hr = 6.5 µg/m3<br/>pm25_1day = 4.4 µg/m3<br/>location_type = outside<br/>","<b>MV Clean Air Ambassador @ Lower Studhorse<\/b><br/><b>deviceDeploymentID = 4f19d256e1787973_10166<\/b><br/><b>pm25_1hr = 1.5 µg/m3<\/b><br/>temperature = 38 F<br/>humidity = 53%<br/>pm25_1hr = 1.5 µg/m3<br/>pm25_1day = 1.5 µg/m3<br/>location_type = outside<br/>","<b>MV Clean Air Ambassador @ McFarland Creek <\/b><br/><b>deviceDeploymentID = f592adb5067ad9d3_13675<\/b><br/><b>pm25_1hr = 3 µg/m3<\/b><br/>temperature = 38 F<br/>humidity = 50%<br/>pm25_1hr = 3 µg/m3<br/>pm25_1day = 2.4 µg/m3<br/>location_type = outside<br/>","<b>MV Clean Air Ambassador @ Methow Estates<\/b><br/><b>deviceDeploymentID = 4a47b9252e16e558_15077<\/b><br/><b>pm25_1hr = 3 µg/m3<\/b><br/>temperature = 37 F<br/>humidity = 58%<br/>pm25_1hr = 3 µg/m3<br/>pm25_1day = 1.8 µg/m3<br/>location_type = outside<br/>","<b>MV Clean Air Ambassador @ Pine Forest <\/b><br/><b>deviceDeploymentID = 0cbfeb2ce4c1553c_13661<\/b><br/><b>pm25_1hr = 1.9 µg/m3<\/b><br/>temperature = 42 F<br/>humidity = 51%<br/>pm25_1hr = 1.9 µg/m3<br/>pm25_1day = 4 µg/m3<br/>location_type = outside<br/>","<b>MV Clean Air Ambassador @ Upper Beaver Creek<\/b><br/><b>deviceDeploymentID = 2e3b5ceea86a885b_10168<\/b><br/><b>pm25_1hr = 1.2 µg/m3<\/b><br/>temperature = 38 F<br/>humidity = 47%<br/>pm25_1hr = 1.2 µg/m3<br/>pm25_1day = 0.7 µg/m3<br/>location_type = outside<br/>","<b>MV Clean Air Ambassador @ Willowbrook Farm<\/b><br/><b>deviceDeploymentID = f96deab8c29aa42b_10134<\/b><br/><b>pm25_1hr = 10.2 µg/m3<\/b><br/>temperature = 41 F<br/>humidity = 45%<br/>pm25_1hr = 10.2 µg/m3<br/>pm25_1day = 6.8 µg/m3<br/>location_type = outside<br/>","<b>MV Clean Air Ambassador-Little Cougar<\/b><br/><b>deviceDeploymentID = 96b108298883ca47_64441<\/b><br/><b>pm25_1hr = 1.8 µg/m3<\/b><br/>temperature = 47 F<br/>humidity = 40%<br/>pm25_1hr = 1.8 µg/m3<br/>pm25_1day = 4.4 µg/m3<br/>location_type = outside<br/>","<b>MV Clean Air Ambassador@Little Star<\/b><br/><b>deviceDeploymentID = b56c0ef677852913_81495<\/b><br/><b>pm25_1hr = 8.7 µg/m3<\/b><br/>temperature = 39 F<br/>humidity = 48%<br/>pm25_1hr = 8.7 µg/m3<br/>pm25_1day = 9 µg/m3<br/>location_type = outside<br/>"],null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLegend","args":[{"colors":["#7E0023","#8F3F97","#FF0000","#FF7E00","#FFFF00","#00E400"],"labels":["Hazardous","Very Unhealthy","Unhealthy","USG","Moderate","Good"],"na_color":null,"na_label":"NA","opacity":1,"position":"bottomright","type":"unknown","title":"AQI","extra":null,"layerId":null,"className":"info legend","group":null}]}],"limits":{"lat":[48.152984,48.609412],"lng":[-120.444339,-120.039328]}},"evals":[],"jsHooks":[]}</script><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># However, data for a specific sensor might not be available for a given month.</span>
<span class="co"># You can make sure to have the expected pat file in your month directory by </span>
<span class="co"># looking for that file.</span>
<span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">archiveDir</span>, <span class="st">"pat/2020/09"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "pat_0cbfeb2ce4c1553c_13661_202009.rda"
##  [2] "pat_2e3b5ceea86a885b_10168_202009.rda"
##  [3] "pat_49215ad49d1a87e3_10188_202009.rda"
##  [4] "pat_4a47b9252e16e558_15077_202009.rda"
##  [5] "pat_4f19d256e1787973_10166_202009.rda"
##  [6] "pat_96b108298883ca47_64441_202009.rda"
##  [7] "pat_ab5dca99422f2c0d_13669_202009.rda"
##  [8] "pat_db5d6b3b79f5830e_39237_202009.rda"
##  [9] "pat_f592adb5067ad9d3_13675_202009.rda"
## [10] "pat_f6c44edd41c941c7_10182_202009.rda"
## [11] "pat_f736fd3fb21fc4da_13667_202009.rda"
## [12] "pat_f96deab8c29aa42b_10134_202009.rda"</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load specific days of pat data for Pine Forest</span>
<span class="va">Pine_Forest</span>  <span class="op">&lt;-</span> 
  <span class="fu"><a href="../../reference/pat_load.html">pat_load</a></span><span class="op">(</span>
    id <span class="op">=</span> <span class="st">"0cbfeb2ce4c1553c_13661"</span>,
    pas <span class="op">=</span> <span class="va">mvcaa</span>, 
    startdate <span class="op">=</span> <span class="fl">20200901</span>,
    enddate <span class="op">=</span> <span class="fl">20201008</span>, 
    timezone <span class="op">=</span> <span class="st">"America/Los_Angeles"</span>
  <span class="op">)</span>

<span class="co"># Basic plot for Pine_Forest </span>
<span class="fu"><a href="../../reference/pat_multiPlot.html">pat_multiplot</a></span><span class="op">(</span><span class="va">Pine_Forest</span><span class="op">)</span></code></pre></div>
<p><img src="MVCAA_Tutorial_5_files/figure-html/load-local-data-2.png" width="672"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load the all-hourly-data-combined sensor object</span>
<span class="va">all_sensors</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../../reference/sensor_load.html">sensor_load</a></span><span class="op">(</span>
    collection <span class="op">=</span> <span class="st">"mvcaa"</span>, <span class="co"># collectionName defined by user </span>
    startdate <span class="op">=</span> <span class="fl">20200901</span>,
    enddate <span class="op">=</span> <span class="fl">20201008</span>,
    timezone <span class="op">=</span> <span class="st">"America/Los_Angeles"</span>
  <span class="op">)</span>

<span class="co"># Plot all hourly values with daily averages</span>
<span class="va">all_sensors</span> <span class="op">%&gt;%</span>
  <span class="fu">AirMonitorPlots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AirMonitorPlots/man/ggplot_pm25Timeseries.html">ggplot_pm25Timeseries</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Methow Valley Smoke -- September, 2020"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">AirMonitorPlots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AirMonitorPlots/man/geom_pm25Points.html">geom_pm25Points</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="st">"square"</span>, alpha <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">AirMonitorPlots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AirMonitorPlots/man/stat_dailyAQCategory.html">stat_dailyAQCategory</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">300</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">AirMonitorPlots</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AirMonitorPlots/man/custom_aqiStackedBar.html">custom_aqiStackedBar</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> </code></pre></div>
<p><img src="MVCAA_Tutorial_5_files/figure-html/load-local-data-3.png" width="672"></p>
<hr>
<p><em>Best of luck assessing air quality in your community!</em></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jonathan Callahan, Hans Martin, Kayleigh Wilson, Tate Brasel, Helen Miller.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
