<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MVCAA Tutorial 3: Creating Airsensor Data • AirSensor</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="MVCAA Tutorial 3: Creating Airsensor Data">
<meta property="og:description" content="AirSensor">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">AirSensor</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/AirSensor_Function_Overview.html">AirSensor Function Overview</a>
    </li>
    <li>
      <a href="../../articles/Developer_Style_Guide.html">Developer Style Guide</a>
    </li>
    <li>
      <a href="../../articles/articles/Australia_on_fire.html">Australia on Fire</a>
    </li>
    <li>
      <a href="../../articles/articles/Custom_QC_Algorithms.html">Custom QC Algorithms</a>
    </li>
    <li>
      <a href="../../articles/articles/DataFlowChart.html">Processing PurpleAir Data</a>
    </li>
    <li>
      <a href="../../articles/articles/MVCAA_Tutorial_1.html">MVCAA Tutorial 1: Creating PAT Data</a>
    </li>
    <li>
      <a href="../../articles/articles/MVCAA_Tutorial_2.html">MVCAA Tutorial 2: Exploring PAT Data</a>
    </li>
    <li>
      <a href="../../articles/articles/MVCAA_Tutorial_3.html">MVCAA Tutorial 3: Creating Airsensor Data</a>
    </li>
    <li>
      <a href="../../articles/articles/MVCAA_Tutorial_4.html">MVCAA Tutorial 4: Exploring Airsensor Data</a>
    </li>
    <li>
      <a href="../../articles/articles/MVCAA_Tutorial_5.html">MVCAA Tutorial 5: Building a Local Archive</a>
    </li>
    <li>
      <a href="../../articles/articles/MVCAA_Tutorial_6.html">MVCAA Tutorial 6: Methow Vallely Smoke</a>
    </li>
    <li>
      <a href="../../articles/articles/SoH_functions.html">SoH Functions</a>
    </li>
    <li>
      <a href="../../articles/articles/Temporal_Aggregation.html">Temporally Aggregated Time Series</a>
    </li>
    <li>
      <a href="../../articles/articles/outlier_detection.html">Outlier Detection with the Hampel Filter</a>
    </li>
    <li>
      <a href="../../articles/articles/pas_introduction.html">PurpleAir Synoptic Data</a>
    </li>
    <li>
      <a href="../../articles/articles/pat_introduction.html">PurpleAir Time Series Data</a>
    </li>
    <li>
      <a href="../../articles/articles/purpleair_failure_modes.html">PurpleAir Failure Modes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MazamaScience/AirSensor/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="MVCAA_Tutorial_3_files/header-attrs-2.5/header-attrs.js"></script><link href="MVCAA_Tutorial_3_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="MVCAA_Tutorial_3_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>MVCAA Tutorial 3: Creating Airsensor Data</h1>
                        <h4 class="author">Mazama Science</h4>
            
            <h4 class="date">2021-03-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MazamaScience/AirSensor/blob/master/vignettes/articles/MVCAA_Tutorial_3.Rmd"><code>vignettes/articles/MVCAA_Tutorial_3.Rmd</code></a></small>
      <div class="hidden name"><code>MVCAA_Tutorial_3.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This tutorial demonstrates how to convert previously generated ‘pat’ timeseries data into hourly-aggregated ‘airsensor’ objects. In order to run the code in this tutorial you must have followed the instructions in Tutorial 1 and created a directory with ‘pas’ and ‘pat’ data files for the Methow Valley. Target audiences include grad students, researchers and any member of the public concerned about air quality and comfortable working with R and RStudio.</p>
<p>Tutorials in this series include:</p>
<ul>
<li><a href="https://mazamascience.github.io/AirSensor/articles/articles/MVCAA_Tutorial_1.html">MVCAA Tutorial 1: Creating PAT Data</a></li>
<li><a href="https://mazamascience.github.io/AirSensor/articles/articles/MVCAA_Tutorial_2.html">MVCAA Tutorial 2: Exploring PAT Data</a></li>
<li><a href="https://mazamascience.github.io/AirSensor/articles/articles/MVCAA_Tutorial_3.html">MVCAA Tutorial 3: Creating Airsensor Data</a></li>
<li><a href="https://mazamascience.github.io/AirSensor/articles/articles/MVCAA_Tutorial_4.html">MVCAA Tutorial 4: Exploring Airsensor Data</a></li>
<li><a href="https://mazamascience.github.io/AirSensor/articles/articles/MVCAA_Tutorial_5.html">MVCAA Tutorial 5: Building a Local Archive</a></li>
<li><a href="https://mazamascience.github.io/AirSensor/articles/articles/MVCAA_Tutorial_6.html">MVCAA Tutorial 6: Methow Vallely Smoke</a></li>
</ul>
</div>
<div id="goal" class="section level2">
<h2 class="hasAnchor">
<a href="#goal" class="anchor"></a>Goal</h2>
<p>The goal in this tutorial is to load previously generated ‘pat’ data and then create and save a multi-sensor ‘airsensor’ object. Aggregation of raw data to quality controlled, hourly averages allows sensor data to be compared with meteorological and air quality data from other sources. Hourly aggregation is the <em>de facto</em> standard for most air quality analysis.</p>
</div>
<div id="sensor-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#sensor-objects" class="anchor"></a>Sensor Objects</h2>
<p>‘airsensor’ objects (sometimes also called ‘sensor’ objects) contain timeseries data derived from ‘pat’ objects. Where ‘pat’ objects contain “raw” data, ‘airsensor’ objects contain highly processed data:</p>
<div id="pat-object" class="section level3">
<h3 class="hasAnchor">
<a href="#pat-object" class="anchor"></a>‘pat’ object</h3>
<ul>
<li>list containing <code>meta</code> and <code>data</code> dataframes</li>
<li>
<code>meta</code> contains spatial metadata for a single sensor</li>
<li>
<code>data</code> records have minute resolution raw data</li>
<li>
<code>data</code> contains multiple parameters from a single sensor</li>
</ul>
</div>
<div id="airsensor-object" class="section level3">
<h3 class="hasAnchor">
<a href="#airsensor-object" class="anchor"></a>‘airsensor’ object</h3>
<ul>
<li>list containing <code>meta</code> and <code>data</code> dataframes</li>
<li>
<code>meta</code> contains spatial metadata for one <em>or more</em> sensors</li>
<li>
<code>data</code> records have hourly resolution aggregated and QC’ed data</li>
<li>
<code>data</code> contains a single parameter from one <em>or more</em> sensors</li>
</ul>
<p>An ‘airsensor’ object is equivalent to and compatible with the <a href="http://mazamascience.github.io/PWFSLSmoke/articles/Data_Model.html">‘ws_monitor’ object</a> defined in the <a href="http://mazamascience.github.io/PWFSLSmoke/index.html">PWFSLSmoke</a> R package. This means that any functions from <strong>PWFSLSmoke</strong> or from <a href="https://mazamascience.github.io/AirMonitorPlots/index.html">AirMonitorPlots</a> designed to work with ‘ws_monitor’ objects can also be used with ‘airsensor’ objects.</p>
<p>This opens up a wide suite of of functionality that can be used to analyze and plot sensor data after it has been converted into an ‘airsensor’ object.</p>
</div>
</div>
<div id="r-script" class="section level2">
<h2 class="hasAnchor">
<a href="#r-script" class="anchor"></a>R Script</h2>
<p>The following R script will take a few moments to run and will create an ‘airsensor’ data file on your computer.</p>
<p>After running the script, a final section will demonstrate how to load and work with this local data file.</p>
<p>This R script can be used as a starting point for those wishing to create small collections of data for other communities and other dates.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Methow Valley local data archive</span>

<span class="co"># ----- Setup ------------------------------------------------------------------</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MazamaScience/AirSensor">AirSensor</a></span><span class="op">)</span>

<span class="co"># Use the default archiveDir unless it is already defined</span>
<span class="kw">if</span> <span class="op">(</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"archiveDir"</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span>
  <span class="va">archiveDir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"~/Data/MVCAA"</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Load previously generated 'pas' and 'pat' data</span>
<span class="va">mvcaa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">archiveDir</span>, <span class="st">"mvcaa.rda"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">patList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">archiveDir</span>, <span class="st">"patList.rda"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># ----- Create 'airsensor' data ------------------------------------------------</span>

<span class="co"># Create an empty List to store things</span>
<span class="va">airsensorList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Initialize counters</span>
<span class="va">idCount</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">patList</span><span class="op">)</span>
<span class="va">count</span> <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="va">successCount</span> <span class="op">&lt;-</span> <span class="fl">0</span>

<span class="co"># Loop over ids and create 'airsensor' objects (might take a while).</span>
<span class="kw">for</span> <span class="op">(</span> <span class="va">id</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">patList</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span>

  <span class="va">count</span> <span class="op">&lt;-</span> <span class="va">count</span> <span class="op">+</span> <span class="fl">1</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"Working on %s (%d/%d) ..."</span>, <span class="va">id</span>, <span class="va">count</span>, <span class="va">idCount</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co"># Use a try-block in case you get "no data" errors</span>
  <span class="va">result</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="op">{</span>
    
    <span class="co"># It's nice to copy-paste the full function signature so you can see all possible arguments</span>
    <span class="va">airsensorList</span><span class="op">[[</span><span class="va">id</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/pat_createAirSensor.html">pat_createAirSensor</a></span><span class="op">(</span>
      pat <span class="op">=</span> <span class="va">patList</span><span class="op">[[</span><span class="va">id</span><span class="op">]</span><span class="op">]</span>,
      <span class="va">parameter</span> <span class="op">&lt;-</span> <span class="st">"pm25"</span>,
      FUN <span class="op">=</span> <span class="va">PurpleAirQC_hourly_AB_01</span>
    <span class="op">)</span>
    <span class="va">successCount</span> <span class="op">&lt;-</span> <span class="va">successCount</span> <span class="op">+</span> <span class="fl">1</span>
    
  <span class="op">}</span>, silent <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  
  <span class="kw">if</span> <span class="op">(</span> <span class="st">"try-error"</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/stop.html">geterrmessage</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  
<span class="op">}</span>

<span class="co"># How many did we get?</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"Successfully created %d/%d pat objects."</span>, <span class="va">successCount</span>, <span class="va">idCount</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Save it in our archive directory</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">airsensorList</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">archiveDir</span>, <span class="st">"airsensorList.rda"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="script-comments" class="section level3">
<h3 class="hasAnchor">
<a href="#script-comments" class="anchor"></a>Script Comments</h3>
<p>The above script is straightforward and easily reused but we should take a moment to describe the arguments to <code><a href="../../reference/pat_createAirSensor.html">pat_createAirSensor()</a></code>:</p>
<ul>
<li>
<code>pat</code> – This is just the ‘pat’ object we are using as input data.</li>
<li>
<code>parameter</code> – The ‘airsensor’ object will contain hourly averaged data for only a single parameter. This will almost always be <code>pm25</code> but it is also possible to create ‘airsensor’ objects for <code>temperature</code> or <code>humidity</code> or any other parameter available in <code>pat$data</code>.</li>
<li>
<code>FUN</code> – This is the quality control (QC) function that will be used when aggregating <code>pat</code> data to an hourly axis. Several functions are available in the <strong>AirSensor</strong> package and it is also possible to create <a href="https://mazamascience.github.io/AirSensor/articles/articles/Custom_QC_Algorithms.html">custom QC algorithms</a>.</li>
</ul>
</div>
</div>
<div id="loading-local-data" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-local-data" class="anchor"></a>Loading Local Data</h2>
<p>Now that we have an <code>airsensorList</code> object with quality controlled data we can load it from our archive and briefly explore it.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># AirSensor package</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MazamaScience/AirSensor">AirSensor</a></span><span class="op">)</span>

<span class="co"># Use the default archiveDir unless it is already defined</span>
<span class="kw">if</span> <span class="op">(</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span><span class="st">"archiveDir"</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span>
  <span class="va">archiveDir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"~/Data/MVCAA"</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Examine archive directory</span>
<span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="va">archiveDir</span><span class="op">)</span> <span class="co"># you should see: "airsensorList.rda" "mvcaa.rda" "patList.rda" </span></code></pre></div>
<pre><code>## [1] "airsensor"                "airsensorList.rda"       
## [3] "Liberty_data.csv"         "Liberty_School_clean.rda"
## [5] "mvcaa.rda"                "pat"                     
## [7] "patList.rda"</code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load files</span>
<span class="va">mvcaa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">archiveDir</span>, <span class="st">"mvcaa.rda"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">patList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">archiveDir</span>, <span class="st">"patList.rda"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">airsensorList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">archiveDir</span>,<span class="st">"airsensorList.rda"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Examine a 'pat' object</span>
<span class="va">pat1</span> <span class="op">&lt;-</span> <span class="va">patList</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">pat1</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "pa_timeseries" "list"</code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">pat1</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 21413    19</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">pat1</span><span class="op">$</span><span class="va">data</span><span class="op">)</span>       <span class="co"># single sensor, multiple parameters</span></code></pre></div>
<pre><code>##  [1] "datetime"    "pm25_A"      "pm25_B"      "temperature" "humidity"   
##  [6] "pressure"    "pm1_atm_A"   "pm25_atm_A"  "pm10_atm_A"  "pm1_atm_B"  
## [11] "pm25_atm_B"  "pm10_atm_B"  "uptime"      "rssi"        "memory"     
## [16] "adc0"        "bsec_iaq"    "datetime_A"  "datetime_B"</code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">pat1</span><span class="op">$</span><span class="va">meta</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "ID"                               "label"                           
##  [3] "sensorType"                       "DEVICE_LOCATIONTYPE"             
##  [5] "THINGSPEAK_PRIMARY_ID"            "THINGSPEAK_PRIMARY_ID_READ_KEY"  
##  [7] "THINGSPEAK_SECONDARY_ID"          "THINGSPEAK_SECONDARY_ID_READ_KEY"
##  [9] "longitude"                        "latitude"                        
## [11] "countryCode"                      "stateCode"                       
## [13] "timezone"                         "deviceID"                        
## [15] "locationID"                       "deviceDeploymentID"              
## [17] "pwfsl_closestDistance"            "pwfsl_closestMonitorID"          
## [19] "sensorManufacturer"               "targetPollutant"                 
## [21] "technologyType"                   "communityRegion"</code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Examine an 'airsensor' object</span>
<span class="va">airsensor1</span> <span class="op">&lt;-</span> <span class="va">airsensorList</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">airsensor1</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "airsensor"  "ws_monitor"</code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">airsensor1</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 720   2</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">airsensor1</span><span class="op">$</span><span class="va">data</span><span class="op">)</span> <span class="co"># single parameter, one or more sensors</span></code></pre></div>
<pre><code>## [1] "datetime"               "ab5dca99422f2c0d_13669"</code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">airsensor1</span><span class="op">$</span><span class="va">meta</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "ID"                               "label"                           
##  [3] "sensorType"                       "DEVICE_LOCATIONTYPE"             
##  [5] "THINGSPEAK_PRIMARY_ID"            "THINGSPEAK_PRIMARY_ID_READ_KEY"  
##  [7] "THINGSPEAK_SECONDARY_ID"          "THINGSPEAK_SECONDARY_ID_READ_KEY"
##  [9] "longitude"                        "latitude"                        
## [11] "countryCode"                      "stateCode"                       
## [13] "timezone"                         "deviceID"                        
## [15] "locationID"                       "deviceDeploymentID"              
## [17] "pwfsl_closestDistance"            "pwfsl_closestMonitorID"          
## [19] "sensorManufacturer"               "targetPollutant"                 
## [21] "technologyType"                   "communityRegion"                 
## [23] "monitorID"                        "elevation"                       
## [25] "siteName"                         "countyName"                      
## [27] "msaName"                          "monitorType"                     
## [29] "siteID"                           "instrumentID"                    
## [31] "aqsID"                            "pwfslID"                         
## [33] "pwfslDataIngestSource"            "telemetryAggregator"             
## [35] "telemetryUnitID"</code></pre>
</div>
<div id="fancy-plot" class="section level2">
<h2 class="hasAnchor">
<a href="#fancy-plot" class="anchor"></a>Fancy Plot</h2>
<p>The following plot shows what is possible for someone highly experienced with R and the Mazama Science packages.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Combine single-sensor 'airsensor' objects into a multi-sensor 'monitor' object</span>
<span class="va">my_monitors</span> <span class="op">&lt;-</span> <span class="fu">PWFSLSmoke</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PWFSLSmoke/man/monitor_combine.html">monitor_combine</a></span><span class="op">(</span><span class="va">airsensorList</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">my_monitors</span><span class="op">$</span><span class="va">data</span><span class="op">)</span> <span class="co"># datetime + deviceDeploymentIDs</span></code></pre></div>
<pre><code>##  [1] "datetime"               "ab5dca99422f2c0d_13669" "f6c44edd41c941c7_10182"
##  [4] "49215ad49d1a87e3_10188" "f736fd3fb21fc4da_13667" "db5d6b3b79f5830e_39237"
##  [7] "4f19d256e1787973_10166" "f592adb5067ad9d3_13675" "4a47b9252e16e558_15077"
## [10] "0cbfeb2ce4c1553c_13661" "2e3b5ceea86a885b_10168" "f96deab8c29aa42b_10134"
## [13] "96b108298883ca47_64441"</code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Use MazamaCoreUtils::dateRange() to ensure we get POSIXct times in the local timezone</span>
<span class="va">dateRange</span> <span class="op">&lt;-</span> <span class="fu">MazamaCoreUtils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MazamaCoreUtils/man/dateRange.html">dateRange</a></span><span class="op">(</span>
  startdate <span class="op">=</span> <span class="fl">20200903</span>, 
  enddate <span class="op">=</span> <span class="fl">20200921</span>, 
  timezone <span class="op">=</span> <span class="st">"America/Los_Angeles"</span>
<span class="op">)</span>

<span class="co"># Load AirMonitorPlots</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MazamaScience/AirMonitorPlots">AirMonitorPlots</a></span><span class="op">)</span>

<span class="co"># Help ggplot out by assigning short labels to be used as the facet label</span>
<span class="va">my_monitors</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">shortName</span> <span class="op">&lt;-</span> 
  <span class="va">my_monitors</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">siteName</span> <span class="op">%&gt;%</span>
  <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="st">"MV Clean Air Ambassador @"</span>, <span class="st">""</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="st">"MV Clean Air Ambassador-"</span>, <span class="st">""</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_trim</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Fancy plot with AQI bars</span>
<span class="va">gg</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/AirMonitorPlots/man/ggplot_pm25Timeseries.html">ggplot_pm25Timeseries</a></span><span class="op">(</span>
    <span class="va">my_monitors</span>,
    <span class="va">dateRange</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
    <span class="va">dateRange</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,
    timezone <span class="op">=</span> <span class="st">"America/Los_Angeles"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Methow Valley PM2.5 values -- Sep 03 - 21, 2020"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/AirMonitorPlots/man/stat_AQCategory.html">stat_AQCategory</a></span><span class="op">(</span>color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">facet_grid</span><span class="op">(</span>rows <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">shortName</span><span class="op">)</span><span class="op">)</span> 

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">gg</span><span class="op">)</span></code></pre></div>
<p><img src="MVCAA_Tutorial_3_files/figure-html/fancy%20plot-1.png" width="672"></p>
<p><em>NOTE:</em> It appears that our default QC algorithm has tossed out many of the values during the smokiest hours. It might be time to go back and try out some of the other QC algorithms or create a new one. This demonstrates why it is so important to work in a well documented, reproducible manner and how data visualization can alert you to pitfalls in your analysis.</p>
<hr>
<p><em>Best of luck assessing air quality in your community!</em></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jonathan Callahan, Hans Martin, Kayleigh Wilson, Tate Brasel, Helen Miller.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
