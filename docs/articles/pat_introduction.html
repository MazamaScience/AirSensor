<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PurpleAir Time Series Data • AirSensor</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="PurpleAir Time Series Data">
<meta property="og:description" content="AirSensor">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">AirSensor</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/AirSensor_Function_Overview.html">AirSensor Function Overview</a>
    </li>
    <li>
      <a href="../articles/Developer_Style_Guide.html">Developer Style Guide</a>
    </li>
    <li>
      <a href="../articles/Creating_Data_Archives.html">Creating Data Archives</a>
    </li>
    <li>
      <a href="../articles/Custom_QC_Algorithms.html">Custom QC Algorithms</a>
    </li>
    <li>
      <a href="../articles/Working_with_PurpleAir_API_Keys.html">Working with PurpleAir API Keys</a>
    </li>
    <li>
      <a href="../articles/outlier_detection.html">Outlier Detection with the Hampel Filter</a>
    </li>
    <li>
      <a href="../articles/pas_introduction.html">PurpleAir Synoptic Data</a>
    </li>
    <li>
      <a href="../articles/pat_introduction.html">PurpleAir Time Series Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MazamaScience/AirSensor/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>PurpleAir Time Series Data</h1>
                        <h4 data-toc-skip class="author">Mazama
Science</h4>
            
            <h4 data-toc-skip class="date">2023-03-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MazamaScience/AirSensor/blob/HEAD/vignettes/articles/pat_introduction.Rmd" class="external-link"><code>vignettes/articles/pat_introduction.Rmd</code></a></small>
      <div class="hidden name"><code>pat_introduction.Rmd</code></div>

    </div>

    
    
<p><em>Time series</em> data provides a minute-by-minute database
structure for transforming and analyzing <a href="https://www.purpleair.com/" class="external-link">PurpleAir</a> sensor data. This
vignette demonstrates an example analysis of an individual monitor
located in Seattle, Washington over a two-month duration in which the
Pacific Northwest experienced <a href="https://www.usnews.com/news/healthiest-communities/articles/2018-08-19/air-quality-to-worsen-in-northwest-as-smoke-returns" class="external-link">hazardous
air-quality conditions</a> caused by wildfires in British Columbia,
Canada.</p>
<p><strong>Disclaimer:</strong> It is highly recommended that you read
<code>vignettes/pas_introduction.Rmd</code> before beginning this
tutorial.</p>
<div class="section level2">
<h2 id="loading-purpleair-timeseries-data">Loading PurpleAir Timeseries data<a class="anchor" aria-label="anchor" href="#loading-purpleair-timeseries-data"></a>
</h2>
<p>PurpleAir sensor readings are uploaded to the cloud every 120 seconds
where they are stored for download and display on the PurpleAir website.
After every interval, the synoptic data is refreshed and the outdated
synoptic data is then stored in a <a href="https://thingspeak.com" class="external-link">ThingSpeak</a> database. In order to
access the ThingSpeak channel API we must first load the synoptic
database, but for the purposes of this example, we are going to use the
<code>example_pas</code> associated with the <em>AirSensor</em>
package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MazamaScience/MazamaCoreUtils" class="external-link">MazamaCoreUtils</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MazamaScience/AirSensor" class="external-link">AirSensor</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define PURPLE_AIR_API_READ_KEY in a .gitignore protected file</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"global_vars.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use an existing 'pas' object</span></span>
<span><span class="va">pas</span> <span class="op">&lt;-</span> <span class="fu">AirSensor</span><span class="fu">::</span><span class="va"><a href="../reference/example_pas.html">example_pas</a></span></span>
<span></span>
<span><span class="co"># Create a new 'pat' object</span></span>
<span><span class="va">pat</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/pat_createNew.html">pat_createNew</a></span><span class="op">(</span></span>
<span>    api_key <span class="op">=</span> <span class="va">PURPLE_AIR_API_READ_KEY</span>,</span>
<span>    pas <span class="op">=</span> <span class="va">pas</span>,</span>
<span>    sensor_index <span class="op">=</span> <span class="st">"3515"</span>,</span>
<span>    startdate <span class="op">=</span> <span class="st">"2022-07-01"</span>,</span>
<span>    enddate <span class="op">=</span> <span class="st">"2022-07-08"</span>,</span>
<span>    timezone <span class="op">=</span> <span class="st">"UTC"</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Notice that when passing our synoptic dataframe “<code>pas</code>” to
<code><a href="../reference/pat_createNew.html">pat_createNew()</a></code>, we also supply a <code>senor_index</code>
and a date-interval. In this case, our monitor-of-interest (MOI) has
sensor_index “3515” and our dates-of-interest are 2022-07-01 to
2022-07-08.</p>
</div>
<div class="section level2">
<h2 id="the-purpleairtimeseries-pat-data-model">The PurpleAirTimeseries (“pat”) Data Model<a class="anchor" aria-label="anchor" href="#the-purpleairtimeseries-pat-data-model"></a>
</h2>
<p>Let’s begin by exploring the attributes of the dataframe returned by
the <code><a href="../reference/pat_createNew.html">pat_createNew()</a></code> function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "meta" "data"</span></span></code></pre>
<p><code>pat</code> contains <em>two</em> dataframes, <code>meta</code>
and <code>data</code>.</p>
<p>The <code>meta</code> dataframe contains metadata of the selected
PurpleAir sensor – this includes non-time series data such as location
information, labels, etc. The <code>data</code> dataframe contains
datestamped sensor readings of PM2.5, temperature, humidity, and other
pertinent sensor data.</p>
<p>We’ll start by plotting PurpleAir’s raw sensor data. We can quickly
display the time series data by using <code><a href="../reference/pat_multiPlot.html">pat_multiPlot()</a></code> and
passing in our raw <code>pat</code> and desired plot type
(“<code>all</code>” sensor data).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pat_multiPlot.html">pat_multiPlot</a></span><span class="op">(</span>plottype <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<p><img src="pat_introduction_files/figure-html/allPlot-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="exploring-time-series-data">Exploring Time Series Data<a class="anchor" aria-label="anchor" href="#exploring-time-series-data"></a>
</h2>
<p>Our <code>pat</code> dataframe spans two months. While this provides
a great overview of PM2.5, it is unwieldy to analyze if we are only
interested in anomalous air quality. We can use
<code><a href="../reference/pat_filterDate.html">pat_filterDate()</a></code> to subset our <code>pat</code> dates. In
this case, we’ll reduce our time range to 2022-07-02 - 2022-07-05.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pat_august</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">pat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/pat_filterDate.html">pat_filterDate</a></span><span class="op">(</span>startdate <span class="op">=</span> <span class="fl">20220702</span>, enddate <span class="op">=</span> <span class="fl">20220705</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pat_august</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pat_multiPlot.html">pat_multiPlot</a></span><span class="op">(</span>plottype <span class="op">=</span> <span class="st">"pm25_over"</span><span class="op">)</span></span></code></pre></div>
<p><img src="pat_introduction_files/figure-html/augustPlot-1.png" width="672"></p>
<p>We can look for correlations in the raw data with
<code><a href="../reference/pat_scatterPlotMatrix.html">pat_scatterPlotMatrix()</a></code>. When a sensor is properly
functioning, the only correlations will be a strong positive one between
between the A and B channels (<code>pm25_A:pm25_B</code>) and a strong
negative one between temperature and humidity.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">pat_august</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/pat_scatterPlotMatrix.html">pat_scatterPlotMatrix</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="pat_introduction_files/figure-html/scatterPlot-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="outlier-detection">Outlier Detection<a class="anchor" aria-label="anchor" href="#outlier-detection"></a>
</h2>
<p>Our <code>pat_august</code> “pat” object displays some intermittent
sensor errors that appear as spikes in the data. In order to identify
and remove PM2.5 outliers like these we can use
<code><a href="../reference/pat_outliers.html">pat_outliers()</a></code>. By default, this function will create a
plot of the raw data with outliers marked with a red asterisk. It can
also be used to replace outliers with window median values.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pat_august_filtered</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">pat_august</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pat_outliers.html">pat_outliers</a></span><span class="op">(</span>replace <span class="op">=</span> <span class="cn">TRUE</span>, showPlot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="pat_introduction_files/figure-html/outlierPlot-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="ab-channel-comparison">A/B Channel Comparison<a class="anchor" aria-label="anchor" href="#ab-channel-comparison"></a>
</h2>
<p>Now that we have a filtered dataset we can subset the data further
and examine it in more detail. The <code><a href="../reference/pat_internalFit.html">pat_internalFit()</a></code>
function will compare PM2.5 data from the A and B channels to verify
that the sensor is functioning properly.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">three_days</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">pat_august</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/pat_filterDate.html">pat_filterDate</a></span><span class="op">(</span>startdate <span class="op">=</span> <span class="fl">20220704</span>, days <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Channel A/B comparison</span></span>
<span><span class="va">three_days</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/pat_internalFit.html">pat_internalFit</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="pat_introduction_files/figure-html/internalFit-1.png" width="672"></p>
<p>The high R<sup>2</sup> value indicates that the two channels are
highly correlated while a slope of ~0.9 suggests a slight relative bias
in the measurements. (Perfect alignment would have a slope of 1.0.)</p>
</div>
<div class="section level2">
<h2 id="comparison-with-federal-monitors">Comparison with Federal Monitors<a class="anchor" aria-label="anchor" href="#comparison-with-federal-monitors"></a>
</h2>
<p>For locations near federal monitors that are part of the <a href="https://tools.airfire.org/monitoring/v4" class="external-link">USFS Monitoring site</a>,
we can also compare the sensor data with hourly data from a federal
monitor</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sensor/Monitor comparison</span></span>
<span><span class="va">three_days</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/pat_externalFit.html">pat_externalFit</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="pat_introduction_files/figure-html/externalFit-1.png" width="672"></p>
<p>Overall, this is an excellent fit with the PurpleAir sensor capturing
the temporal evolution of the wildfire smoke event impacting Seattle.
The sensor data is biased a little high relative to the monitoring data
but the much higher temporal resolution of the sensor provides a rich
dataset to work with.</p>
<p>This package contains many additional functions for working with
PurpleAir data and users are encouraged to review the reference
documentation.</p>
<p><em>Happy Exploring!</em></p>
<p><em>Mazama Science</em></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jonathan Callahan, Hans Martin, Kayleigh Wilson, Tate Brasel, Helen Miller.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
